var PS;(function(){"use strict";function Kt(){if($t>=0){$t-=1}else{Jt-=.05;if(Jt<=0){PS.timerStop(Vt);Vt=null;Jt=0}Ut.style.opacity=Jt}}function Qt(e){var t;t=typeof e;if(t==="number"){if(isNaN(e)){t="NaN"}}else if(t==="object"){if(e){if(e instanceof Array){t="array"}}else{t="null"}}return t}function Gt(e,t,n,r){var i,s;i=e;if(i!==true&&i!==false){if(i===null){i=false}else if(i===PS.CURRENT){i=t}else if(i===PS.DEFAULT){i=n}else{s=Qt(i);if(s==="undefined"){i=r}else if(s==="number"){i=i!==0}else{i=PS.ERROR}}}return i}function Yt(e,t){var n,r,i,s;for(n in e){if(e.hasOwnProperty(n)){r=e[n];s=Qt(r);if(s==="object"){i={};Yt(r,i);r=i}t[n]=r}}}function Zt(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();return false}function en(){var e,t,n,r,i;e=[];for(t=0;t<arguments.length;t+=1){n=arguments[t];r=n-65536;i=n>65535?[55296+(r>>10),56320+(r&1023)]:[n];e.push(String.fromCharCode.apply(null,i))}return e.join("")}function tn(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v;o=Y.context;u=Y.bead_size;a=e.left;f=e.top;l=u;c=u;if(!e.visible){o.fillStyle=s;o.fillRect(a,f,l,c);return}p=e.size<u;d=e.radius;if(p||d>0){if(e.bgColor.a<255){o.fillStyle=s;o.fillRect(a,f,l,c)}if(e.bgColor.a>0){o.fillStyle=i;o.fillRect(a,f,l,c)}if(p){a+=e.margin;f+=e.margin;l=e.size;c=e.size}}h=e.border;if(h.width>0){if(h.color.a<255){o.fillStyle=s;o.fillRect(a,f,l,c)}if(h.color.a>0){o.fillStyle=t;if(d===0){o.fillRect(a,f,l,c)}else{v=Math.floor(l*d/100);v=o.fillRoundedRect(a,f,l,c,v)}}a+=h.left;f+=h.top;l-=h.left+h.right;c-=h.top+h.bottom}o.fillStyle=n;if(d===0){o.fillRect(a,f,l,c)}else{v=Math.floor(l*d/100);o.fillRoundedRect(a,f,l,c,v)}if(e.glyph.code>0&&e.glyph.color.a>0){Y.context.font=e.glyph.font;o.fillStyle=r;o.fillText(e.glyph.str,e.left+e.glyph.x,e.top+e.glyph.y)}}function nn(e,t){var n,r;n=e.a*(1-t.a);r={r:Math.floor(t.r*t.a+e.r*n),g:Math.floor(t.g*t.a+e.g*n),b:Math.floor(t.b*t.a+e.b*n)};return r}function rn(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;r=t.r;i=t.g;s=t.b;o=e.planes;u=o.length;for(a=0;a<u;a+=1){l=o[a];f=l.color;c=f.r;h=f.g;p=f.b;d=f.a;if(d>0){if(d<255){v=Math.max(0,Math.min(d/255,1));m={r:r,g:i,b:s,a:1};g={r:c,g:h,b:p,a:v};y=nn(m,g);r=y.r;i=y.g;s=y.b}else{r=c;i=h;s=p}}}c=r;h=i;p=s;n.rgb=c*A+h*O+p;n.r=c;n.g=h;n.b=p;n.str=X[c]+V[h]+$[p]}function on(e){var t,n,r,i,s,o,u,a;t=e.str;n=Y.canvas;n.style.backgroundColor=t;document.body.style.backgroundColor=t;et.statusP.style.backgroundColor=t;et.inputP.style.backgroundColor=t;Ut.style.backgroundColor=t;for(r=0;r<Y.count;r+=1){i=Z[r];s=i.planes[0];o=s.color;if(o.a<255){rn(i,e,sn);u=sn.str}else{u=i.color.str}a=i.border.color;if(!i.visible||i.size<Y.bead_size||i.radius>0||o.a<255||a.a<255){tn(i,a.str,u,i.glyph.color.str,i.bgColor.str,t)}}}function un(e){var t,n,r;if(e.r>127){t=0}else{t=255}if(e.g>127){n=0}else{n=255}if(e.b>127){r=0}else{r=255}Ut.style.color=X[t]+V[n]+$[r]}function an(e){Y.canvas.style.boxShadow=Y.shadow.params+e.str}function fn(e){et.statusP.style.color=e.str;et.inputP.style.color=e.str}function ln(e,t){var n;n=Z[t];tn(n,n.border.color.str,e.str,n.glyph.color.str,n.bgColor.str,Y.color.str)}function cn(e,t){var n;n=Z[t];tn(n,e.str,n.color.str,n.glyph.color.str,n.bgColor.str,Y.color.str)}function hn(e,t){var n;n=Z[t];tn(n,n.border.color.str,n.color.str,e.str,n.bgColor.str,Y.color.str)}function pn(e){e.dirty=true;tt=true}function dn(){var e,t,n;nt=0;if(tt){e=Y.count;for(t=0;t<e;t+=1){n=Z[t];if(n.dirty){n.dirty=false;tn(n,n.border.color.str,n.color.str,n.glyph.color.str,n.bgColor.str,Y.color.str);nt+=1}}tt=false}}function vn(){var e;if(!qt){e=document.getElementById(r);e.style.display="inline";It.value="";qt=true;Rt=false}}function mn(e){if(typeof e!=="string"||e.length<1){e="???"}PS.debug("WARNING: "+e+"\n")}function bn(e){var t,n,r;t="";if(e.search(".js")!==-1){n=e.lastIndexOf("/")+1;r=e.substr(n).replace(/^[\s\(\)]+|[\s\(\)]+$/g,"");if(r.split(":").length===3){r=r.substr(0,r.lastIndexOf(":"))}if(r!==""){t+="    "+r+"\n"}}else if(yn&&e.search(".htm")!==-1){t+="\n"+e}return t}function wn(e){var t,n,r,i;if(console&&console.log){console.log(e)}if(!e.split){return e}t=e.split("\n");i="";n=t.length;for(r=0;r<n;r+=1){i+=bn(t[r])}return i}function En(e,t){var n;lt=false;if(Vt){PS.timerStop(Vt)}if(typeof e!=="string"||e.length<1){e="???"}n="ERROR: "+e+"\n";Ut.style.opacity=1;Ut.innerHTML=n;if(gn&&t&&t.stack){n+=wn(t.stack)+"\n"}PS.debug(n);if(zt){PS.audioPlay(z.audio.error_sound,{path:z.audio.path})}return PS.ERROR}function Sn(e){try{throw new Error("!")}catch(t){return En(e,t)}}function xn(){var e;e=document.getElementById(t);e.scrollTop=e.scrollHeight}function Tn(){dt=[];vt=0}function Nn(e){e.active=false;e.kill=false;e.r=0;e.g=0;e.b=0;e.rgb=null;e.tr=0;e.tg=0;e.tb=0;e.trgb=0;e.tstr=null;e.step=0;e.rate=0;e.onStep=null;e.onEnd=null;e.params=null;e.frames.length=0}function Cn(e,t,n){var r;r={element:e,exec:t,execEnd:n,frames:[]};Nn(r);return r}function kn(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w,E,S;e.step=0;e.frames.length=0;if(t===s&&n===o&&r===u&&i===a){return}e.tr=s;e.tg=o;e.tb=u;e.ta=a;e.trgb=s*A+o*O+u;e.tstr=X[s]+V[o]+V[u]+J[a];f=t;l=n;c=r;h=i;if(t>s){g=-(t-s)}else{g=s-t}if(n>o){y=-(n-o)}else{y=o-n}if(r>u){b=-(r-u)}else{b=u-r}if(i>a){w=-(i-a)}else{w=a-i}if(e.rate<j){p=1}else{p=Math.ceil(e.rate/j)}d=100/p;v=0;do{E=false;m={};v+=d;if(v>=100){m.r=s;m.g=o;m.b=u;m.a=a}else{if(f!==s){S=v*g/100;f=t+S;f=Math.round(f);E=true}m.r=f;if(l!==o){S=v*y/100;l=n+S;l=Math.round(l);E=true}m.g=l;if(c!==u){S=v*b/100;c=r+S;c=Math.round(c);E=true}m.b=c;if(h!==a){S=v*w/100;h=i+S;h=Math.round(h);E=true}m.a=h}m.rgb=m.r*A+m.g*O+m.b;m.str=X[m.r]+V[m.g]+V[m.b]+J[m.a];e.frames.push(m);if(!E){return}}while(v<100)}function Ln(e,t,n,r,i,s,o,u,a){kn(e,t,n,r,i,s,o,u,a);if(e.frames.length>0){e.kill=false;e.active=true;dt.push(e)}}function An(e,t,n,r,i){var s,o,u,a;s=e.active;e.active=false;o=e.frames.length;if(o>0){u=e.step;if(u>=o){u=o-1}a=e.frames[u];kn(e,a.r,a.g,a.b,a.a,t,n,r,i)}if(e.frames.length>0){e.active=s}}function On(){ht=[];pt=0}function _n(){var e,t,n,r,i,s,o,u,a,f,l,c,h;e="[_tick] ";ct+=1;t=false;vt+=1;if(vt>=j){vt=0;n=dt.length;r=0;while(r<n){i=dt[r];o=i.frames.length;if(i.kill){dt.splice(r,1);n-=1}else if(i.active){s=i.frames[i.step];l=i.onStep;if(l){h=[o,i.step,s.rgb];if(i.params){h=h.concat(i.params)}try{f=l.apply(_,h);if(f===false||f===null){i.step=o-1;s=i.frames[i.step]}t=true}catch(p){En(e+"fader .onStep failed ["+p.message+"]",p);return}}if(i.exec){try{i.exec(s,i.element)}catch(d){En(e+"fader .exec failed ["+d.message+"]",d);return}}i.step+=1;if(i.step>=o){i.active=false;i.step=0;i.frames.length=0;if(i.execEnd){try{i.execEnd(s,i.element)}catch(v){En(e+"fader .execEnd failed ["+v.message+"]",v);return}}l=i.onEnd;if(l){h=i.params;if(!h){h=[]}try{l.apply(_,h);t=true}catch(m){En(e+"fader .onEnd failed ["+m.message+"]",m);return}}dt.splice(r,1);n-=1}else{r+=1}}else{r+=1}}}n=Et.length;if(Nt&&n>0){if(Ct>0){Ct-=1}else{Ct=kt;for(r=0;r<n;r+=1){u=Et[r];if(u){try{t=true;Mn.time=ct;PS.keyDown(u,St,xt,Mn)}catch(g){En(e+"Key repeat failed ["+g.message+"]",g);return}}}}}n=ht.length;if(n>0){r=0;while(r<n){a=ht[r];c=a.id;a.count-=1;if(a.count<1){a.count=a.delay;try{f=a.exec.apply(_,a.arglist);t=true}catch(y){f=En(e+"Timed function failed ["+y.message+"]",y)}if(f===PS.ERROR){PS.timerStop(c)}n=ht.length}a=ht[r];if(a&&a.id===c){r+=1}}}if(t){dn()}}function Pn(e){var t,n,r,i,s,o,u,a,f;rn(e,Y.color,Dn);t=Dn.rgb;n=e.color;r=Dn.r;i=Dn.g;s=Dn.b;o=n.r;u=n.g;a=n.b;n.rgb=t;n.r=r;n.g=i;n.b=s;n.str=Dn.str;if(e.visible){f=e.fader;if(f.rate>0){if(f.rgb!==null){Ln(f,f.r,f.g,f.b,255,r,i,s,255)}else if(!f.active){Ln(f,o,u,a,255,r,i,s,255)}else{An(f,r,i,s,255)}}else{pn(e)}}}function Hn(e,t,n,r,i){var s,o,u,a;s=n;if(s!==PS.CURRENT&&s!==PS.DEFAULT){a=Qt(s);if(a==="undefined"){s=PS.CURRENT}else if(a==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else{return Sn(e+"red value invalid")}}o=r;if(o!==PS.CURRENT&&o!==PS.DEFAULT){a=Qt(o);if(a==="undefined"){o=PS.CURRENT}else if(a==="number"){o=Math.floor(o);if(o<0){o=0}else if(o>255){o=255}}else{return Sn(e+"green value invalid")}}u=i;if(u!==PS.CURRENT&&u!==PS.DEFAULT){a=Qt(u);if(a==="undefined"){u=PS.CURRENT}else if(a==="number"){u=Math.floor(u);if(u<0){u=0}else if(u>255){u=255}}else{return Sn(e+"blue value invalid")}}t.rgb=null;t.r=s;t.g=o;t.b=u;return PS.DONE}function Bn(e,t){var n,r,i,s,o,u;n=Math.floor(t);if(n<1){n=r=s=u=0}else if(n>=16777215){n=16777215;r=s=u=255}else{r=n/A;r=Math.floor(r);i=r*A;s=(n-i)/O;s=Math.floor(s);o=s*O;u=n-i-o}e.rgb=n;e.r=r;e.g=s;e.b=u}function Fn(e,t,n,r){var i,s,o,u,a;i=jn;i.rgb=0;i.r=null;i.g=null;i.b=null;i.str="";s=Qt(t);if(n!==undefined||r!==undefined){if(s==="number"||s==="undefined"||t===PS.CURRENT||t===PS.DEFAULT){o=Hn(e,i,t,n,r);if(o===PS.ERROR){return PS.ERROR}}else{if(s==="array"){return Sn(e+"Extraneous arguments after color array")}if(s==="object"){return Sn(e+"Extraneous arguments after color object")}return Sn(e+"red argument invalid")}}else if(s==="number"){Bn(i,t)}else if(s==="array"){a=t.length;if(a<1){i.rgb=PS.CURRENT}else{o=Hn(e,i,t[0],t[1],t[2]);if(o===PS.ERROR){return PS.ERROR}}}else if(s==="object"){u=t.rgb;s=Qt(u);if(s==="undefined"||u===null){o=Hn(e,i,t.r,t.g,t.b);if(o===PS.ERROR){return PS.ERROR}}else if(s==="number"){Bn(i,u)}else if(u===PS.CURRENT||u===PS.DEFAULT){i.rgb=u}else{return Sn(e+".rgb property invalid")}}else if(s==="undefined"||t===PS.CURRENT){i.rgb=PS.CURRENT}else if(t===PS.DEFAULT){i.rgb=PS.DEFAULT}else{return Sn(e+"color argument invalid")}return i}function In(e){var t,n,r,i;t=Y.bead_size;e.glyph.x=Math.round(t/2);r=e.glyph.scale;if(r<100){n=Math.round(t*r/100)}else{n=t}e.glyph.size=i=Math.round(n/2);e.glyph.font=i+"px 'droid'";e.glyph.y=Math.round((t-i)/2+i/2)}function qn(e){e.dirty=true;e.active=true;e.visible=true;e.planes=null;e.color={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"};e.bgColor={r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"};e.radius=0;e.scale=100;e.data=0;e.exec=null;e.border={width:1,equal:true,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}};e.glyph={str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}};e.planes=[{height:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}}];In(e);Nn(e.fader);Nn(e.borderFader);Nn(e.glyphFader)}function Rn(e,t){var n,r,i,s,o,u;n=e.planes;if(t<1){r=n[0];return r.color}i=n.length;for(s=1;s<i;s+=1){r=n[s];if(r.height===t){return r.color}}u=z.bead.color;o={rgb:u.rgb,r:u.r,g:u.g,b:u.b,a:0};if(e.active){s=0;while(s<i){r=n[s];if(r.height>t){break}s+=1}n.splice(s,0,{height:t,color:o})}return o}function Un(e){if(e.glyph.code>0){return e.border.gmax}return e.border.max}function zn(e,t){e.border.equal=true;e.border.width=t;e.border.top=t;e.border.left=t;e.border.bottom=t;e.border.right=t}function Wn(e){var t,n,r,i,s,o,u;t=Y.bead_size;if(e.scale<100){n=Math.floor(t*e.scale/100);r=t-n;if(r>0&&r%2){n+=1}}else{n=t;e.margin=0;e.senseLeft=e.left;e.senseRight=e.right;e.senseTop=e.top;e.senseBottom=e.bottom}e.size=n;if(n!==t){e.margin=i=Math.floor((t-n)/2);e.senseLeft=e.left+i;e.senseRight=e.right-i;e.senseTop=e.top+i;e.senseBottom=e.bottom-i}u=e.border;u.max=Math.floor((n-8)/2);u.gmax=Math.floor((n-e.glyph.size)/2);s=Un(e);if(u.equal){if(u.width>s){zn(e,s)}}else{o=u.top;if(o>s){u.top=s}o=u.left;if(o>s){u.left=s}o=u.bottom;if(o>s){u.bottom=s}o=u.right;if(o>s){u.right=s}}}function Xn(e){var t;t=e.data;if(t===null){t=0}return t}function Vn(e){it={start:e,end:0,duration:0,events:[]}}function $n(e,t,n){it.events.push({x:e,y:t,start:n,end:0,duration:0})}function Jn(e){var t,n;t=it.events.length;if(t>0){n=it.events[t-1];it.end=e;n.end=e;n.duration=e-n.start;it.duration+=n.duration}}function Kn(){var e,t,n,r;e={start:it.start,end:it.end,duration:it.duration,events:[]};t=it.events.length;for(n=0;n<t;n+=1){r=it.events[n];e.events.push({x:r.x,y:r.y,start:r.start,end:r.end,duration:r.duration})}return e}function Qn(e){var t,n;t=false;if(it.events.length>1){Jn(e);if(PS.swipe){try{n=Kn();PS.swipe(n,{time:e});t=true}catch(r){return En("PS.swipe() failed ["+r.message+"]",r)}}}it=null;return t}function Yn(e){var t,n,r;if(e.active){n=false;r=ct;e.timeTouch=r;Gn.time=r;Vn(r);$n(e.x,e.y,r);if(e.exec){try{t=Xn(e);e.exec(e.x,e.y,t,Gn);n=true}catch(i){return En("Bead "+e.x+", "+e.y+" function failed ["+i.message+"]",i)}}if(PS.touch){try{t=Xn(e);PS.touch(e.x,e.y,t,Gn);n=true}catch(s){return En("PS.touch() failed ["+s.message+"]",s)}}if(n){dn()}}return PS.DONE}function er(e){var t,n,r;if(e.active){n=false;r=ct;Zn.time=e.timeRelease=r;if(PS.release){try{t=Xn(e);PS.release(e.x,e.y,t,Zn);n=true}catch(i){return En("PS.release() failed ["+i.message+"]",i)}}if(Qn(r)||n){dn()}}return PS.DONE}function nr(e){var t,n;Ht=true;if(e.active){if(PS.enter){t=ct;tr.time=e.timeEnter=t;if(Pt&&it){$n(e.x,e.y,t)}try{n=Xn(e);PS.enter(e.x,e.y,n,tr);dn()}catch(r){return En("PS.enter() failed ["+r.message+"]",r)}}}return PS.DONE}function ir(e){var t,n;if(e.active){if(PS.exit){t=ct;rr.time=e.timeExit=t;if(Pt&&it){Jn(t)}try{n=Xn(e);PS.exit(e.x,e.y,n,rr);dn()}catch(r){return En("PS.exit() failed ["+r.message+"]",r)}}}return PS.DONE}function or(){var e;Ht=false;if(PS.exitGrid){e=ct;sr.time=Y.timeExit=e;try{PS.exitGrid(sr);dn()}catch(t){return En("PS.exitGrid() failed ["+t.message+"]",t)}if(Pt&&it){$n(-1,-1,e)}}return PS.DONE}function ur(){Bt=-1}function ar(e,t){var n,r,i,s;n=Y.canvas;e+=document.body.scrollLeft+document.documentElement.scrollLeft-n.offsetLeft-Y.padLeft;t+=document.body.scrollTop+document.documentElement.scrollTop-n.offsetTop-Y.padRight;if(e>=Y.left&&e<Y.right&&t>=Y.top&&t<Y.bottom){i=0;while(i<Y.count){r=Z[i];if(t>=r.top&&t<r.bottom){for(s=0;s<Y.x;s+=1){if(e>=r.senseLeft&&e<r.senseRight&&t>=r.senseTop&&t<r.senseBottom){return r}i+=1;r=Z[i]}return null}i+=Y.x}}return null}function fr(e){var t;if(qt){It.blur()}t=ct;Pt=true;Vn(t);$n(-1,-1,t);return Zt(e)}function lr(e){if(it){Qn(ct)}Pt=false;return Zt(e)}function cr(e){It.focus();return Zt(e)}function hr(e){return Zt(e)}function pr(e){var t,n,r;if(qt){It.blur()}t=e.clientX;n=e.clientY;Pt=true;r=ar(t,n);if(r){Yn(r)}return Zt(e)}function dr(e){var t,n,r;t=e.clientX;n=e.clientY;r=ar(t,n);if(r){er(r)}Pt=false;return Zt(e)}function vr(e){var t,n,r,i;t=e.clientX;n=e.clientY;r=ar(t,n);if(r){if(r.index!==Bt){if(Bt>=0){i=Z[Bt];ir(i)}nr(r);Bt=r.index}}else if(Bt>=0){i=Z[Bt];ir(i);Bt=-1}return Zt(e)}function mr(n){var r,i;if(Bt>=0){r=Z[Bt];ir(r);Bt=-1}i=n.relatedTarget;if(i){i=i.id;if(i&&(i===e||i===t||i.length<1)){or()}}return Zt(n)}function gr(e){var t,n,r,i;if(qt){It.blur()}if(jt!==B){return Zt(e)}r=e.changedTouches[0];jt=r.identifier;Pt=true;t=r.pageX;n=r.pageY;i=ar(t,n);if(i){Ht=true;Ft=i.index;Yn(i)}else{Ft=B;Ht=false}return Zt(e)}function yr(e){var t,n,r,i,s,o,u;t=e.changedTouches.length;for(n=0;n<t;n+=1){r=e.changedTouches[n];i=r.identifier;if(i===jt){jt=B;Ft=B;Ht=false;s=r.pageX;o=r.pageY;u=ar(s,o);if(u){er(u)}Pt=false;break}}return Zt(e)}function br(e){var t,n,r,i,s,o,u,a;t=e.changedTouches.length;for(n=0;n<t;n+=1){r=e.changedTouches[n];i=r.identifier;if(i===jt){s=r.pageX;o=r.pageY;u=ar(s,o);if(u){Ht=true;if(Ft!==u.index){if(Ft!==B){a=Z[Ft];ir(a)}Ft=u.index;nr(u)}}else{if(Ft!==B){a=Z[Ft];ir(a)}Ft=B;if(Ht){or()}}break}}return Zt(e)}function wr(){var e;Et.length=0;St=false;xt=false;Tt=false;for(e=0;e<256;e+=1){wt[e]=0}}function Er(e,t){var n;n=e;if(n>=65&&n<=90){if(!t){n+=32}}else{n=gt[n];if(t&&n<256){n=yt[n]}}return n}function Sr(e){return e>=32||e===13||e===8||e===9||e===27}function xr(e){var t,n,r,i,s,o;t="[_keyDown] ";n=false;if(Rt){return true}if(PS.keyDown){St=e.shiftKey;xt=e.ctrlKey;Tt=e.altKey;if(!e.which){r=e.keyCode}else{r=e.which}i=Er(r,St);if(Sr(i)){if(!wt[i]){wt[i]=1;if(i!==r&&wt[r]){wt[r]=0;o=Et.indexOf(r);if(o>=0){Et.splice(o,1)}}if(Et.length<1){Ct=Lt}if(Et.indexOf(i)<0){Et.push(i)}try{Mn.time=ct;PS.keyDown(i,St,xt,Mn);n=true}catch(u){En(t+"PS.keyDown failed ["+u.message+"]",u)}}}else if(i===P){s=Et.length;for(o=0;o<s;o+=1){i=r=Et[o];if(r>=97&&r<=122){i-=32}else if(r<256){i=yt[r]}if(i!==r){wt[r]=0;wt[i]=1;Et[o]=i;try{Mn.time=ct;PS.keyDown(i,true,xt,Mn);n=true}catch(a){En(t+"PS.keyDown failed ["+a.message+"]",a)}}}}if(n){dn()}}return Zt(e)}function Nr(e){var t,n,r,i,s,o,u,a;t="[_keyUp] ";n=false;if(Rt){return true}if(PS.keyUp){r=St=e.shiftKey;i=xt=e.ctrlKey;if(!e.which){s=e.keyCode}else{s=e.which}o=Er(s,St);if(Sr(o)){wt[o]=0;u=Et.indexOf(o);if(u>=0){Et.splice(u,1)}if(Et.length<1){Ct=0;St=false;xt=false;Tt=false}try{Tr.time=ct;PS.keyUp(o,r,i,Tr);n=true}catch(f){En(t+"PS.keyUp failed ["+f.message+"]",f)}}else if(o===P){a=Et.length;for(u=0;u<a;u+=1){o=s=Et[u];if(s<256){o=bt[s]}if(o!==s){wt[s]=0;wt[o]=1;Et[u]=o;try{Tr.time=ct;PS.keyDown(o,false,i,Tr);n=true}catch(l){En(t+"PS.keyDown failed ["+l.message+"]",l)}}}}if(n){dn()}}return Zt(e)}function Lr(e){var t;if(!Ht){return true}if(PS.input){if(!e){e=window.event}t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));if(t>=1){t=PS.WHEEL_FORWARD}else{t=PS.WHEEL_BACKWARD}try{Cr.wheel=t;kr.time=ct;PS.input(Cr,kr);dn()}catch(n){En("PS.input() failed ["+n.message+"]",n)}}return Zt(e)}function Ar(){if(!mt){document.addEventListener("keydown",xr,false);document.addEventListener("keyup",Nr,false);mt=true}}function Or(){wr();if(mt){document.removeEventListener("keydown",xr,false);document.removeEventListener("keyup",Nr,false);mt=false}}function Mr(){var e;e=Y.canvas;e.style.display="block";Pt=false;document.addEventListener("mousedown",fr,false);document.addEventListener("mouseup",lr,false);e.addEventListener("mousedown",pr,false);e.addEventListener("mouseup",dr,false);e.addEventListener("mousemove",vr,false);e.addEventListener("mouseout",mr,false);Ar();window.addEventListener("DOMMouseScroll",Lr,false);window.addEventListener("mousewheel",Lr,false);if(At){jt=B;Ft=B;document.addEventListener("touchmove",br,false);document.addEventListener("touchstart",gr,false);document.addEventListener("touchend",yr,false);document.addEventListener("touchcancel",yr,false)}}function _r(e){var t,n,r,i,s,o;t=Y.color;n=Y.fader;r=e.rgb;if(r===PS.CURRENT){return t.rgb}if(r===null){i=e.r;if(i===PS.CURRENT){e.r=i=t.r}else if(i===PS.DEFAULT){e.r=i=z.grid.color.r}s=e.g;if(s===PS.CURRENT){e.g=s=t.g}else if(s===PS.DEFAULT){e.g=s=z.grid.color.g}o=e.b;if(o===PS.CURRENT){e.b=o=t.b}else if(o===PS.DEFAULT){e.b=o=z.grid.color.b}e.rgb=i*A+s*O+o}else if(r===PS.DEFAULT){e={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}}if(t.rgb!==e.rgb||n.rate>0&&n.rgb!==null&&n.rgb!==e.rgb){t.rgb=e.rgb;i=e.r;s=e.g;o=e.b;t.str=e.str=X[i]+V[s]+$[o];if(n.rate>0){if(n.rgb!==null){Ln(n,n.r,n.g,n.b,255,i,s,o,255)}else if(!n.active){Ln(n,t.r,t.g,t.b,255,i,s,o,255)}else{An(n,i,s,o,255)}}else{on(e);un(e)}t.r=i;t.g=s;t.b=o}return t.rgb}function Dr(e,t){var n,r,i,s,o;n=Y.shadow;r=t.rgb;if(r!==PS.CURRENT){if(r===null){i=t.r;if(i===PS.CURRENT){t.r=i=n.r}else if(i===PS.DEFAULT){t.r=i=z.grid.shadow.r}s=t.g;if(s===PS.CURRENT){t.g=s=n.g}else if(s===PS.DEFAULT){t.g=s=z.grid.shadow.g}o=t.b;if(o===PS.CURRENT){t.b=o=n.b}else if(o===PS.DEFAULT){t.b=o=z.grid.shadow.b}t.rgb=i*A+s*O+o}else if(r===PS.DEFAULT){t={show:false,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "}}if(n.rgb!==t.rgb){n.rgb=t.rgb;i=t.r;s=t.g;o=t.b;n.str=t.str=X[i]+V[s]+$[o];n.r=i;n.g=s;n.b=o}}if(e!==PS.CURRENT){Y.shadow.show=e}if(Y.shadow.show){an(n)}else{Y.canvas.style.boxShadow="none"}return{show:Y.shadow.show,rgb:n.rgb}}function Pr(e,t){var n,r,i,s,o,u,a;Tn();Nn(Y.fader);Nn(et.fader);Y.plane=0;it=[];if(!Y.ready||e!==Y.x||t!==Y.y){Y.x=e;Y.y=t;Y.count=e*t;Y.left=0;Y.top=0;if(e>=t){n=Math.floor(_t/e)}else{n=Math.floor(_t/t)}Y.bead_size=n;Y.width=n*e;Y.height=n*t;Y.right=Y.width;Y.bottom=Y.height;Y.canvas.width=Y.width;Y.canvas.height=Y.height;Y.context.textAlign="center";Y.context.textBaseline="middle";s=0;u=Y.top;for(i=0;i<t;i+=1){o=Y.left;for(r=0;r<e;r+=1){a=Z[s];a.x=r;a.y=i;a.left=o;a.right=o+n;a.top=u;a.bottom=u+n;qn(a);Wn(a);o+=n;s+=1}u+=n}while(s<M){a=Z[s];a.visible=false;a.active=false;s+=1}}else{for(r=0;r<Y.count;r+=1){a=Z[r];qn(a);Wn(a)}}tt=true;_r({rgb:PS.DEFAULT});PS.statusColor(PS.DEFAULT);dn();ur();Y.ready=true}function Hr(e,t){if(Qt(e)!=="number"){return Sn(t+"x argument not a number")}e=Math.floor(e);if(e<0){return Sn(t+"x argument negative")}if(e>=Y.x){return Sn(t+"x argument exceeds grid width")}return e}function Br(e,t){if(Qt(e)!=="number"){return Sn(t+"y argument not a number")}e=Math.floor(e);if(e<0){return Sn(t+"y argument negative")}if(e>=Y.y){return Sn(t+"y argument exceeds grid height")}return e}function jr(e,t,n,r,i,s,o,u){var a,f,l;if(n===PS.ALL){if(r===PS.ALL){for(f=0;f<Y.y;f+=1){for(a=0;a<Y.x;a+=1){l=t(a,f,i,s,o,u);if(l===PS.ERROR){break}}}return l}r=Br(r,e);if(r===PS.ERROR){return PS.ERROR}for(a=0;a<Y.x;a+=1){l=t(a,r,i,s,o,u);if(l===PS.ERROR){break}}return l}if(r===PS.ALL){n=Hr(n,e);if(n===PS.ERROR){return PS.ERROR}for(f=0;f<Y.y;f+=1){l=t(n,f,i,s,o,u);if(l===PS.ERROR){break}}return l}n=Hr(n,e);if(n===PS.ERROR){return PS.ERROR}r=Br(r,e);if(r===PS.ERROR){return PS.ERROR}l=t(n,r,i,s,o,u);return l}function Fr(e,t,n){var r,i,s,o,u,a,f,l,c;r=t*Y.x+e;i=Z[r];s=z.bead.color;o=Rn(i,Y.plane);u=i.fader;a=n.rgb;if(!i.active||a===PS.CURRENT){return o.rgb}if(a===null){f=n.r;if(f===PS.CURRENT){n.r=f=o.r}else if(f===PS.DEFAULT){n.r=f=s.r}l=n.g;if(l===PS.CURRENT){n.g=l=o.g}else if(l===PS.DEFAULT){n.g=l=s.g}c=n.b;if(c===PS.CURRENT){n.b=c=o.b}else if(c===PS.DEFAULT){n.b=c=s.b}n.rgb=f*A+l*O+c}else if(a===PS.DEFAULT){n={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}}if(o.rgb!==n.rgb||u.rate>0&&u.rgb!==null&&u.rgb!==n.rgb){o.rgb=n.rgb;o.r=n.r;o.g=n.g;o.b=n.b;Pn(i)}return o.rgb}function Ir(e,t,n){var r,i,s;r=t*Y.x+e;i=Z[r];s=Rn(i,Y.plane);if(i.active&&n!==PS.CURRENT&&n!==s.a){s.a=n;Pn(i)}return s.a}function qr(e,t){var n,r,i,s,o,u,a;n=Qt(t);if(n==="undefined"||t===PS.CURRENT){return{rgb:PS.CURRENT,r:0,g:0,b:0,onStep:PS.CURRENT,onEnd:PS.CURRENT,params:PS.CURRENT}}if(t===PS.DEFAULT){return{rgb:PS.DEFAULT,r:0,g:0,b:0,onStep:PS.DEFAULT,onEnd:PS.DEFAULT,params:PS.DEFAULT}}if(n!=="object"){return Sn(e+"options argument invalid")}r=t.rgb;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Qt(r);if(n==="undefined"||r===null){t.rgb=PS.CURRENT}else if(n==="number"){r=Math.floor(r);if(r<=PS.COLOR_BLACK){r=PS.COLOR_BLACK;i=0;o=0;s=0}else if(r>=PS.COLOR_WHITE){r=PS.COLOR_WHITE;i=255;o=255;s=255}else{i=r/A;i=Math.floor(i);u=i*A;o=(r-u)/O;o=Math.floor(o);a=o*O;s=r-u-a}t.rgb=r;t.r=i;t.g=o;t.b=s}else{return Sn(e+"options.rgb property invalid")}}else{t.r=0;t.g=0;t.b=0}r=t.onStep;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Qt(r);if(n==="undefined"||r===null){t.onStep=PS.CURRENT}else if(n!=="function"){return Sn(e+"options.onStep property invalid")}}r=t.onEnd;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Qt(r);if(n==="undefined"||r===null){t.onEnd=PS.CURRENT}else if(n!=="function"){return Sn(e+"options.onEnd property invalid")}}r=t.params;if(r!==PS.CURRENT&&r!==PS.DEFAULT){n=Qt(r);if(n==="undefined"||r===null){t.params=PS.CURRENT}else if(n!=="array"){return Sn(e+"options.params property invalid")}}return t}function Rr(e,t,n,r){var i,s,o,u,a,f,l;i=t*Y.x+e;s=Z[i];o=s.color;u=s.fader;a=u.rate;if(s.active){if(n===PS.CURRENT){f=a}else if(n===PS.DEFAULT){f=z.fader.rate}else{f=n}l=r.rgb;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.rgb=z.fader.rgb}else{u.rgb=l}u.r=r.r;u.g=r.g;u.b=r.b}l=r.onStep;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onStep=z.fader.onStep}else{u.onStep=l}}l=r.onEnd;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onEnd=z.fader.onEnd}else{u.onEnd=l}}l=r.params;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.params=z.fader.params}else{u.params=l}}if(a!==f){u.rate=f;if(f<1){u.active=false;u.kill=true}else if(u.active){An(u,o.r,o.g,o.b,255)}}}return{rate:u.rate,rgb:u.rgb,onStep:u.onStep,onEnd:u.onEnd,params:u.params}}function Ur(e,t,n){var r,i;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT&&i.scale!==n){i.scale=n;Wn(i);pn(i)}return i.scale}function zr(e,t,n){var r,i,s;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT&&i.radius!==n){i.radius=n;if(!i.border.equal&&n>0){s=Math.max(i.border.top,i.border.left,i.border.bottom,i.border.right);zn(i,s)}pn(i)}return i.radius}function Wr(e,t,n){var r,i,s,o,u,a,f,l;r=t*Y.x+e;i=Z[r];s=z.bead.bgColor;o=i.bgColor;u=n.rgb;if(!i.active||u===PS.CURRENT){return o.rgb}if(u===null){a=n.r;if(a===PS.CURRENT){n.r=a=o.r}else if(a===PS.DEFAULT){n.r=a=s.r}f=n.g;if(f===PS.CURRENT){n.g=f=o.g}else if(f===PS.DEFAULT){n.g=f=s.g}l=n.b;if(l===PS.CURRENT){n.b=l=o.b}else if(l===PS.DEFAULT){n.b=l=s.b}n.rgb=a*A+f*O+l}else if(u===PS.DEFAULT){n={r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"}}if(o.rgb!==n.rgb){o.rgb=n.rgb;o.r=a=n.r;o.g=f=n.g;o.b=l=n.b;o.str=X[a]+V[f]+V[l]+J[o.a];if(i.active&&(i.scale<100||i.radius>0)){pn(i)}}return o.rgb}function Xr(e,t,n){var r,i,s;r=t*Y.x+e;i=Z[r];s=i.bgColor;if(n!==PS.CURRENT&&n!==s.a){s.a=n;s.str=X[s.r]+V[s.g]+V[s.b]+J[n];if(i.active&&(i.scale<100||i.radius>0)){pn(i)}}return s.a}function Vr(e,t,n){var r,i;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT){if(n===null){i.data=z.bead.data;i.fader.data=i.data;i.borderFader.data=i.data;i.glyphFader.data=i.data}else{i.data=n;i.fader.data=n;i.borderFader.data=n;i.glyphFader.data=n}}return i.data}function $r(e,t,n){var r,i;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT){i.exec=n}return i.exec}function Jr(e,t,n){var r,i;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT&&i.visible!==n){i.visible=n;if(!n){i.fader.kill=true;i.borderFader.kill=true;i.glyphFader.kill=true}pn(i)}return i.visible}function Kr(e,t,n){var r,i;r=t*Y.x+e;i=Z[r];if(n!==PS.CURRENT){i.active=n}return i.active}function Qr(e,t,n){var r,i,s,o,u,a,f,l,c;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT){s=Un(i);if(Qt(n)==="number"){if(n>s){n=s}if(n!==i.border.width){zn(i,n);pn(i)}}else{u=false;a=n.top;if(a===PS.CURRENT){a=i.border.top}else{if(a>s){a=s}if(a!==i.border.top){i.border.top=a;u=true}}f=n.left;if(f===PS.CURRENT){f=i.border.left}else{if(f>s){f=s}if(f!==i.border.left){i.border.left=f;u=true}}l=n.bottom;if(l===PS.CURRENT){l=i.border.bottom}else{if(l>s){l=s}if(l!==i.border.bottom){i.border.bottom=l;u=true}}c=n.right;if(c===PS.CURRENT){c=i.border.right}else{if(c>s){c=s}if(c!==i.border.right){i.border.right=c;u=true}}if(a===f&&a===c&&a===l){zn(i,a);if(u){pn(i)}}else if(i.radius>0){s=Math.max(a,f,l,c);zn(i,s);pn(i)}else{i.border.equal=false;if(u){pn(i)}}}}o={top:i.border.top,left:i.border.left,bottom:i.border.bottom,right:i.border.right,equal:i.border.equal};if(!i.border.equal){i.border.width=Math.max(o.top,o.left,o.bottom,o.right)}o.width=i.border.width;return o}function Gr(e,t,n){var r,i,s,o,u,a,f,l,c,h;r=t*Y.x+e;i=Z[r];s=i.border.color;o=z.bead.border.color;u=i.borderFader;a=n.rgb;if(i.active&&a!==PS.CURRENT){if(a===null){f=n.r;if(f===PS.CURRENT){n.r=f=s.r}else if(f===PS.DEFAULT){n.r=f=o.r}l=n.g;if(l===PS.CURRENT){n.g=l=s.g}else if(l===PS.DEFAULT){n.g=l=o.g}c=n.b;if(c===PS.CURRENT){n.b=c=s.b}else if(c===PS.DEFAULT){n.b=c=o.b}n.rgb=f*A+l*O+c}else if(a===PS.DEFAULT){n={r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}}if(s.rgb!==n.rgb||u.rate>0&&u.rgb!==null&&u.rgb!==n.rgb){s.rgb=n.rgb;f=n.r;l=n.g;c=n.b;n.a=h=s.a;s.str=n.str=X[f]+V[l]+V[c]+J[h];if(i.visible){if(u.rate>0){if(u.rgb!==null){Ln(u,u.r,u.g,u.b,h,f,l,c,h)}else if(!u.active){Ln(u,s.r,s.g,s.b,h,f,l,c,h)}else{An(u,f,l,c,h)}}else{pn(i)}}s.r=f;s.g=l;s.b=c}}return s.rgb}function Yr(e,t,n){var r,i,s,o,u,a,f;r=t*Y.x+e;i=Z[r];s=i.border.color;if(i.active&&n!==PS.CURRENT&&n!==s.a){o=s.r;u=s.g;a=s.b;s.str=X[o]+V[u]+V[a]+J[n];if(i.visible){f=i.borderFader;if(f.rate>0){if(!f.active){if(f.rgb!==null){Ln(f,f.r,f.g,f.b,s.a,o,u,a,n)}else{Ln(f,o,u,a,s.a,o,u,a,n)}}else{An(f,o,u,a,n)}}else{pn(i)}}s.a=n}return s.a}function Zr(e,t,n,r){var i,s,o,u,a,f,l;i=t*Y.x+e;s=Z[i];u=s.border.color;o=s.borderFader;a=o.rate;if(s.active){if(n===PS.CURRENT){f=a}else if(n===PS.DEFAULT){f=z.fader.rate}else{f=n}l=r.rgb;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.rgb=z.fader.rgb}else{o.rgb=l}o.r=r.r;o.g=r.g;o.b=r.b}l=r.onStep;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.onStep=z.fader.onStep}else{o.onStep=l}}l=r.onEnd;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.onEnd=z.fader.onEnd}else{o.onEnd=l}}l=r.params;if(l!==PS.CURRENT){if(l===PS.DEFAULT){o.params=z.fader.params}else{o.params=l}}if(a!==f){o.rate=f;if(f<1){o.active=false;o.kill=true}else if(o.active){An(o,u.r,u.g,u.b,255)}}}return{rate:o.rate,rgb:o.rgb,onStep:o.onStep,onEnd:o.onEnd,params:o.params}}function ei(e,t,n){var r,i,s;r=t*Y.x+e;i=Z[r];if(i.active&&n!==PS.CURRENT&&i.glyph.code!==n){i.glyph.code=n;if(n<1){s=""}else{s=String.fromCodePoint(n)}i.glyph.str=s;pn(i)}return i.glyph.code}function ti(e,t,n){var r,i,s,o,u,a,f,l,c,h;r=t*Y.x+e;i=Z[r];s=i.glyph.color;o=z.bead.glyph.color;u=i.glyphFader;a=n.rgb;if(i.active&&a!==PS.CURRENT){if(a===null){f=n.r;if(f===PS.CURRENT){n.r=f=s.r}else if(f===PS.DEFAULT){n.r=f=o.r}l=n.g;if(l===PS.CURRENT){n.g=l=s.g}else if(l===PS.DEFAULT){n.g=l=o.g}c=n.b;if(c===PS.CURRENT){n.b=c=s.b}else if(c===PS.DEFAULT){n.b=c=o.b}n.rgb=f*A+l*O+c}else if(a===PS.DEFAULT){n={r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}if(s.rgb!==n.rgb||u.rate>0&&u.rgb!==null&&u.rgb!==n.rgb){s.rgb=n.rgb;f=n.r;l=n.g;c=n.b;n.a=h=s.a;s.str=n.str=X[f]+V[l]+V[c]+J[h];if(i.visible){if(u.rate>0){if(u.rgb!==null){Ln(u,u.r,u.g,u.b,h,f,l,c,h)}if(!u.active){Ln(u,s.r,s.g,s.b,h,f,l,c,h)}else{An(u,f,l,c,h)}}else{pn(i)}}s.r=f;s.g=l;s.b=c}}return s.rgb}function ni(e,t,n){var r,i,s,o,u,a,f;r=t*Y.x+e;i=Z[r];s=i.glyph.color;if(i.active&&n!==PS.CURRENT&&n!==s.a){o=s.r;u=s.g;a=s.b;s.str=X[o]+V[u]+V[a]+J[n];if(i.visible){f=i.glyphFader;if(f.rate>0){if(!f.active){Ln(f,o,u,a,s.a,o,u,a,n)}else{An(f,o,u,a,n)}}else{pn(i)}}s.a=n}return s.a}function ri(e,t,n){var r,i,s;r=t*Y.x+e;i=Z[r];s=i.glyph.scale;if(i.active&&n!==PS.CURRENT&&n!==s){i.glyph.scale=n;if(i.visible){In(i);pn(i)}}return i.glyph.scale}function ii(e,t,n,r){var i,s,o,u,a,f,l;i=t*Y.x+e;s=Z[i];o=s.glyph.color;u=s.glyphFader;a=u.rate;if(s.active){if(n===PS.CURRENT){f=a}else if(n===PS.DEFAULT){f=z.fader.rate}else{f=n}l=r.rgb;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.rgb=z.fader.rgb}else{u.rgb=l}u.r=r.r;u.g=r.g;u.b=r.b}l=r.onStep;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onStep=z.fader.onStep}else{u.onStep=l}}l=r.onEnd;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.onEnd=z.fader.onEnd}else{u.onEnd=l}}l=r.params;if(l!==PS.CURRENT){if(l===PS.DEFAULT){u.params=z.fader.params}else{u.params=l}}if(a!==f){u.rate=f;if(f<1){u.active=false;u.kill=true}else if(u.active){An(u,o.r,o.g,o.b,255)}}}return{rate:u.rate,rgb:u.rgb,onStep:u.onStep,onEnd:u.onEnd,params:u.params}}function si(e){var t,n,r,i,s;t=e.getAttribute("data-id");n=ot.length;for(r=0;r<n;r+=1){i=ot[r];if(i.id===t){s=i.exec;ot.splice(r,1);break}}try{s(PS.ERROR)}catch(o){En("[PS.imageLoad] .exec function failed ["+o.message+"]",o)}Sn("[PS.imageLoad] Error loading "+e.src)}function oi(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;n="[_imageExtract] ";r=e.width;if(Qt(r)!=="number"||r<1){return Sn(n+"image width invalid")}r=Math.floor(r);i=e.height;if(Qt(i)!=="number"||i<1){return Sn(n+"image height invalid")}i=Math.floor(i);try{st.width=r;st.height=i;s=st.getContext("2d");s.drawImage(e,0,0,r,i,0,0,r,i)}catch(g){return En(n+"image extraction failed @ 1 ["+g.message+"]",g)}try{o=s.getImageData(0,0,r,i)}catch(y){return En(n+"image extraction failed @ 2 ["+y.message+"]",y)}u={width:o.width,height:o.height};a=o.data;f=a.length;l=[];h=c=0;if(t===1){l.length=f/4;while(c<f){p=a[c];d=a[c+1];v=a[c+2];l[h]=p*A+d*O+v;c+=4;h+=1}}else if(t===2){l.length=f/2;while(c<f){p=a[c];d=a[c+1];v=a[c+2];m=a[c+3];l[h]=p*A+d*O+v;l[h+1]=m;c+=4;h+=2}}else if(t===3){l.length=f/4*3;while(c<f){p=a[c];d=a[c+1];v=a[c+2];l[h]=p;l[h+1]=d;l[h+2]=v;c+=4;h+=3}}else{l.length=f;while(c<f){l[c]=a[c];c+=1;l[c]=a[c];c+=1;l[c]=a[c];c+=1;l[c]=a[c];c+=1}}u.pixelSize=t;u.data=l;return u}function ui(e){var t,n,r,i,s,o,u,a;t=e.getAttribute("data-id");n=ot.length;for(r=0;r<n;r+=1){i=ot[r];if(i.id===t){s=i.exec;o=i.format;u=i.source;ot.splice(r,1);break}}a=oi(e,o);if(a!==PS.ERROR){try{a.source=u;a.id=t;s(a)}catch(f){En("[PS.imageLoad] .exec function failed ["+f.message+"]",f)}}}function ai(e,t){var n,r,i,s,o,u,a,f;if(Qt(t)!=="object"){return Sn(e+"image argument not an object")}n=t.width;if(Qt(n)!=="number"){return Sn(e+"image.width not a number")}n=Math.floor(n);if(n<1){return Sn(e+"image.width < 1")}t.width=n;r=t.height;if(Qt(r)!=="number"){return Sn(e+"image.height not a number")}r=Math.floor(r);if(r<1){return Sn(e+"image.height < 1")}t.height=r;i=t.pixelSize;if(Qt(i)!=="number"){return Sn(e+"image.pixelSize not a number")}i=Math.floor(i);if(i<1&&i>4){return Sn(e+"image.pixelSize is not 1, 2, 3 or 4")}t.pixelSize=i;o=t.data;if(Qt(o)!=="array"){return Sn(e+"image.data is not an array")}u=o.length;s=n*r*i;if(u!==s){return Sn(e+"image.data length invalid")}for(a=0;a<u;a+=1){f=o[a];if(Qt(f)!=="number"){return Sn(e+"image.data["+a+"] not a number")}if(f<0){return Sn(e+"image.data["+a+"] negative")}if(i<3){if(f>16777215){return Sn(e+"image.data["+a+"] > 0xFFFFFF")}}else if(f>255){return Sn(e+"image.data["+a+"] > 255")}}return true}function fi(e,t){var n,r;n=e.toString(16).toUpperCase();if(t){r=n.length;while(r<t){n="0"+n;r+=1}}return"0x"+n}function li(e,t,n,r,i,s,o){var u;if(e<3){u="";if(t){u+=fi(n,6)}else{u+=n}if(e===2){if(t){u+=", "+fi(o,2)}else{u+=", "+o}}}else{if(t){u=fi(r,2)+", "+fi(i,2)+", "+fi(s,2)}else{u=r+", "+i+", "+s}if(e===4){if(t){u+=", "+fi(o,2)}else{u+=", "+o}}}return u}function ci(){var e;e={id:E+ft,placed:false,visible:true,x:0,y:0,ax:0,ay:0,image:null,color:null,collide:null,width:0,height:0,plane:-1};ft+=1;at.push(e);return e}function hi(e,t){var n,r,i;if(typeof e!=="string"||e.length<1){return Sn(t+"sprite argument invalid")}n=at.length;for(r=0;r<n;r+=1){i=at[r];if(i.id===e){return i}}return Sn(t+"sprite id '"+e+"' does not exist")}function pi(e,t,n,r,i){var s,o,u,a,f,l,c,h,p;if(t===undefined){t=e.x;n=e.y;r=e.width;i=e.height}s=Y.x;t-=e.ax;if(t>=s){return}if(t<0){r+=t;if(r<1){return}t=0}if(t+r>s){r=s-t}u=t+r;o=Y.y;n-=e.ay;if(n>=o){return}if(n<0){i+=n;if(i<1){return}n=0}if(n+i>o){i=o-n}a=n+i;for(l=n;l<a;l+=1){for(f=t;f<u;f+=1){h=f+l*s;c=Z[h];if(c.active){p=Rn(c,e.plane);p.r=255;p.g=255;p.b=255;p.a=0;p.rgb=16777215;Pn(c)}}}}function di(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;t=e.width;n=e.height;if(t<1||n<1){return}r=Y.x;f=0;s=e.x-e.ax;if(s>=r){return}if(s<0){t+=s;if(t<1){return}s=0;f=e.width-t}if(s+t>r){t=r-s}u=s+t;i=Y.y;l=0;o=e.y-e.ay;if(o>=i){return}if(o<0){n+=o;if(n<1){return}o=0;l=e.height-n}if(o+n>i){n=i-o}a=o+n;c=e.color;if(c){for(p=o;p<a;p+=1){for(h=s;h<u;h+=1){v=h+p*r;d=Z[v];if(d.active){m=Rn(d,e.plane);m.rgb=c.rgb;m.r=c.r;m.g=c.g;m.b=c.b;m.a=c.a;Pn(d)}}}}else{g=e.image.data;for(p=o;p<a;p+=1){y=(l*e.width+f)*4;for(h=s;h<u;h+=1){v=h+p*r;d=Z[v];if(d.active){b=g[y];w=g[y+1];E=g[y+2];S=g[y+3];m=Rn(d,e.plane);m.rgb=b*A+w*O+E;m.r=b;m.g=w;m.b=E;m.a=S;Pn(d)}y+=4}l+=1}}}function vi(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;n="[_collisionCheck] ";s=e.x-e.ax;o=e.y-e.ay;u=e.width;a=e.height;f=e.collide;r=at.length;for(i=0;i<r;i+=1){l=at[i];c=l.id;if(c!==t&&l.visible&&l.placed){h=l.x-l.ax;p=l.y-l.ay;d=l.width;v=l.height;m=l.collide;if(h>s){g=h-s}else{g=s-h}if(p>o){y=p-o}else{y=o-p}b=null;if(s===h-u||s===h+d){if(o<=p&&y<=a||o>=p&&y<=v){b=PS.SPRITE_TOUCH}}else if(o===p-a||o===p+v){if(s<=h&&g<=u||s>=h&&g<=d){b=PS.SPRITE_TOUCH}}else if(s>=h&&s<h+d){if(o<=p&&y<a||o>=p&&y<v){b=PS.SPRITE_OVERLAP}}else if(h>=s&&h<s+u){if(p<=o&&y<v||p>=o&&y<a){b=PS.SPRITE_OVERLAP}}if(b){if(f){try{f(t,e.plane,c,l.plane,b)}catch(w){En(n+t+" collide function failed ["+w.message+"]",w);return}}if(m){try{m(c,l.plane,t,e.plane,b)}catch(E){En(n+c+" collide function failed ["+E.message+"]",E);return}}}}}}function mi(e){this.content=[];this.scoreFunction=e}function gi(e,t,n,r){var i,s,o,u,a,f,l;if(n>e){i=n-e}else{i=e-n}if(r>t){s=r-t}else{s=t-r}if(e<n){o=1}else{o=-1}if(t<r){u=1}else{u=-1}a=i-s;l=[];while(e!==n||t!==r){f=a*2;if(f>-s){a-=s;e+=o}if(e===n&&t===r){l.push([e,t]);break}if(f<i){a+=i;t+=u}l.push([e,t])}return l}function yi(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d;if(i>n){o=i-n}else{o=n-i}if(s>r){u=s-r}else{u=r-s}if(n<i){a=1}else{a=-1}if(r<s){f=1}else{f=-1}l=o-u;h=[];while(n!==i||r!==s){c=l*2;if(c>-u){l-=u;n+=a}if(n===i&&r===s){h.push([n,r]);return h}if(c<o){l+=o;r+=f}d=r*t+n;p=e[d];if(!p.value){return null}h.push([n,r])}return h}function bi(e,t,n,r){var i,s,o;if(n>e){i=n-e}else{i=e-n}if(r>t){s=r-t}else{s=t-r}if(i>s){o=s*F+(i-s)}else{o=i*F+(s-i)}return o}function wi(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;o=[];u=r.x;a=r.y;f=t-1;l=n-1;p=a*t;c=(a-1)*t;h=(a+1)*t;g=false;y=false;b=false;w=false;if(u>0){d=u-1;v=p+d;m=e[v];if(!m.value){w=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(u<f){d=u+1;v=p+d;m=e[v];if(!m.value){b=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(a>0){v=c+u;m=e[v];if(!m.value){g=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(a<l){v=h+u;m=e[v];if(!m.value){y=true}else if(!m.closed){m.cost=m.value;o.push(m)}}if(!i){if(u>0){d=u-1;if(a>0&&(s||!w&&!g)){v=c+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*F;o.push(m)}}if(a<l&&(s||!w&&!y)){v=h+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*F;o.push(m)}}}if(u<f){d=u+1;if(a>0&&(s||!g&&!b)){v=c+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*F;o.push(m)}}if(a<l&&(s||!y&&!b)){v=h+d;m=e[v];if(m.value&&!m.closed){m.cost=m.value*F;o.push(m)}}}}return o}function Ei(e){return e.f}function Si(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;if(t===r&&n===i){return[]}u=e.width;a=e.height;f=e.nodes;l=n*u+t;c=f[l];if(!c.value){return[]}l=i*u+r;c=f[l];if(!c.value){return[]}if(!s){h=yi(f,u,t,n,r,i);if(h){return h}}p=f.length;for(y=0;y<p;y+=1){c=f[y];c.f=0;c.g=0;c.h=0;c.cost=0;c.closed=false;c.visited=false;c.parent=null}h=[];d=new mi(Ei);l=n*u+t;c=f[l];d.push(c);while(d.size()>0){v=d.pop();if(v.x===r&&v.y===i){S=v;while(S.parent){h.push([S.x,S.y]);S=S.parent}h.reverse();break}v.closed=true;m=wi(f,u,a,v,s,o);g=m.length;for(y=0;y<g;y+=1){b=m[y];w=v.g+b.cost;E=b.visited;if(!E||w<b.g){b.visited=true;b.parent=v;b.h=b.h||bi(b.x,b.y,r,i);b.g=w;b.f=b.g+b.h;if(!E){d.push(b)}else{d.rescore(b)}}}}return h}function xi(e,t,n,r,i,s){var o,u,a,f,l,c,h,p;o=[];o.length=r*i;u=e.nodes;a=n+i;h=0;for(c=n;c<a;c+=1){f=c*e.width+t;for(l=0;l<r;l+=1){p=u[f];if(s!==PS.CURRENT){if(s===PS.DEFAULT){p.value=p.ovalue}else{p.value=s}}o[h]=p.value;h+=1;f+=1}}return o}function Ti(e,t,n){var r,i,s,o,u,a,f,l;i=n.length;r=[];r.length=i;s=0;for(u=0;u<t;u+=1){for(o=0;o<e;o+=1){f=n[s];a={x:o,y:u,value:f,ovalue:f,f:0,g:0,h:0,cost:0,parent:null,closed:false,visited:false};r[s]=a;s+=1}}l={id:S+Xt,width:e,height:t,nodes:r};Xt+=1;Wt.push(l);return l}function Ni(e){var t,n,r;t=Wt.length;for(n=0;n<t;n+=1){r=Wt[n];if(r.id===e){return r}}return null}function Ci(e){var t,n,r,i,s;t=Wt.length;for(n=0;n<t;n+=1){r=Wt[n];if(r.id===e){i=r.nodes;t=i.length;for(s=0;s<t;s+=1){i[s]=null}r.nodes=null;Wt.splice(n,1);return true}}return false}function ki(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;s=e.nodes;o=e.width;u=e.height;a=1;while(a<o){f=[];l=r-a;h=r+a;c=i-a;p=i+a;d=l;if(d<0){d=0}v=h+1;if(v>=o){v=o}if(c>=0){m=c*o+d;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=1}}if(p<u){m=p*o+d;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=1}}d=c+1;if(d<0){d=0}v=p;if(v>=u){v=u}if(l>=0){m=d*o+l;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=o}}if(h<o){m=d*o+h;for(g=d;g<v;g+=1){y=s[m];if(y.value){f.push([y.x,y.y])}m+=o}}b=f.length;if(b){if(b===1){return f[0]}w=o+u;for(g=0;g<b;g+=1){x=f[g];S=bi(t,n,x[0],x[1]);if(S<w){w=S;E=g}}return f[E]}a+=1}return[t,n]}function Li(e){et.inputP.style.display="none";Ar();et.statusNode.nodeValue=et.text=e;et.statusP.style.display="block"}function Ai(e){var t,n,r;t=e.which;if(!t){t=e.keyCode}if(t===PS.KEY_ENTER){n=et.input.value;r=et.exec;if(typeof r==="function"){try{r(n)}catch(i){En("PS.statusInput() function failed ["+i.message+"]",i)}}et.input.removeEventListener("keydown",Ai,false);Li(et.text);return Zt(e)}return true}function Oi(e,t){var n;et.statusP.style.display="none";et.label=n=e;if(n.length<1){n=">"}et.inputNode.nodeValue=n;et.exec=t;et.input.value="";Or();et.input.addEventListener("keydown",Ai,false);et.inputP.style.display="block";et.input.focus()}function Mi(){var e,t,n,r,i,s,o,u,a,f,l,c;e=["January","February","March","April","May","June","July","August","September","October","November","December"];t=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];r=["SUN","MON","TUE","WED","THU","FRI","SAT"];i=new Date;s={time:i.getTime(),year:i.getFullYear(),month:i.getMonth(),date:i.getDate(),day:i.getDay(),hours24:i.getHours(),minutes:i.getMinutes(),seconds:i.getSeconds(),milliseconds:i.getMilliseconds(),zone:i.getTimezoneOffset()};s.monthName=e[s.month];s.monthShort=t[s.month];s.dayName=n[s.day];s.dayShort=r[s.day];s.hours=s.hours24+1;if(s.hours24>11){s.am_pm="PM";if(s.hours24>12){s.hours=s.hours24-12}}else{s.am_pm="AM"}if(s.date<10){o="0"+s.date}else{o=s.date.toString()}if(s.hours<10){u="0"+s.hours}else{u=s.hours.toString()}if(s.minutes<10){a=":0"+s.minutes}else{a=":"+s.minutes}if(s.seconds<10){f=":0"+s.seconds}else{f=":"+s.seconds}if(s.milliseconds<10){l=".00"+s.milliseconds}else if(s.milliseconds<100){l=".0"+s.milliseconds}else{l="."+s.milliseconds}c=l.length;if(c===2){l+="00"}else if(c===3){l+="0"}s.string=s.dayShort+" "+o+" "+s.monthShort+" "+s.year+" "+u+a+f+l+" "+s.am_pm;return s}function Di(){try{document.createEvent("TouchEvent");return true}catch(e){return false}}function Pi(){var e,t,n,r,i;e=window.navigator.userAgent.toLowerCase();t=window.navigator.platform.toLowerCase();if(/firefox/.test(e)){n="Firefox";if(/fennec/.test(e)){n+=" Mobile"}i=/firefox\/[\.\d]+/.exec(e)[0].split("/")[1]}else if(/chrome/.test(e)){n="Chrome";i=/chrome\/[\d\.]+/.exec(e)[0].split("/")[1]}else if(/safari/.test(e)){n="Safari";if(/iphone/.test(e)||/ipad/.test(e)||/ipod/.test(e)){r="iOS"}}else if(/msie/.test(e)){n="Internet Explorer";if(/iemobile/.test(e)){n+=" Mobile"}i=/msie \d+[.]\d+/.exec(e)[0].split(" ")[1]}else if(/trident/.test(e)){n="Internet Explorer";i=/rv\:\d+[.]\d+/.exec(e)[0].split(":")[1]}else if(/opera/.test(e)){n="Opera";if(/mini/.test(e)){n+=" Mini"}else if(/mobile/.test(e)){n+=" Mobile"}}else if(/android/.test(e)){n="Android";r=/android\s[\.\d]+/.exec(e)}if(!i){try{i=/version\/[\.\d]+/.exec(e);if(i){i=i[0].split("/")[1]}else{i=/opera\/[\.\d]+/.exec(e)[0].split("/")[1]}}catch(s){console.error("Problem detecting browser: "+s.message);i=""}}if(t==="win32"||t==="win64"){r="Windows"}else if(t==="macintel"||t==="macppc"){r="Mac OS X ";r+=/10[\.\_\d]+/.exec(e)[0];if(/[\_]/.test(r)){r=r.split("_").join(".")}}if(!r){if(/linux/.test(t)){r="Linux"}else if(/windows/.test(e)){r="Windows"}}W.host.app=n;if(i){W.host.version=i}W.host.os=r}function Hi(){var e,t,n,r,i,s,o;Ot=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;Mt=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e=T/4*5;if(Ot>=e&&Mt>=e){r=T;i=N;s=C;o=k}else{t=Ot/5*4;n=Mt/5*4;r=Math.min(t,n);r=Math.floor(r/8)*8;i=N*(r/T);i=Math.floor(i*100)/100;o=k*(r/T);o=Math.floor(o);s=Math.floor(o/8)}_t=r;Dt=i+"em";z.grid.shadow.params="0px 0px "+o+"px "+s+"px "}var e="outer";var t="main";var n="init";var r="debug";var i="stsp";var s="inp";var o="inlabel";var u="inspan";var a="inbox";var f="graph";var l="grid";var c="footer";var h="monitor";var p="login";var d="login_em";var v="login_pw1";var m="login_pw2";var g="login_but";var y="login_su";var b="login_re";var w="image_";var E="sprite_";var S="pathmap_";var x="timer_";var T=512;var N=1.25;var C=8;var k=64;var L=1/255;var A=256*256;var O=256;var M=1024;var _={};var D=6;var P=16;var H=17;var B=-1;var j=4;var F=1.4142;var I=16;var q=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"];var R=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"];var U=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"];var z={grid:{width:512,x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:false,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:false,timeExit:0},status:{text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},fader:{active:false,kill:false,r:0,g:0,b:0,rgb:null,tr:0,tg:0,tb:0,trgb:0,tstr:null,step:0,rate:0,onStep:null,onEnd:null,params:null},bead:{dirty:true,active:true,visible:true,planes:null,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},bgColor:{r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},radius:0,scale:100,data:0,exec:null,timeTouch:0,timeRelease:0,timeEnter:0,timeExit:0,border:{width:1,equal:true,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}},audio:{volume:.5,max_volume:1,path:"http://alpheus.wpi.edu/~bmoriarty/ps/audio/",loop:false,error_sound:"fx_uhoh"}};var W={engine:"Perlenspiel",major:3,minor:2,revision:5,audio:null,host:{app:"",version:"",os:""},inputs:{touch:false},date:null};var X,V,$,J;var K=null;var Q=null;var G=null;var Y;var Z;var et;var tt=false;var nt=0;var rt=1;var it=null;var st;var ot;var ut;var at;var ft;var lt;var ct;var ht;var pt;var dt;var vt;var mt;var gt;var yt;var bt;var wt;var Et;var St;var xt;var Tt;var Nt;var Ct;var kt;var Lt;var At;var Ot;var Mt;var _t;var Dt;var Pt=false;var Ht;var Bt=-1;var jt;var Ft;var It;var qt;var Rt;var Ut;var zt;var Wt;var Xt;var Vt=null;var $t=50;var Jt=1;var sn={rgb:0,r:0,g:0,b:0,str:""};var gn=true;var yn=false;var Mn={time:0};var Dn={rgb:0,r:0,g:0,b:0,str:""};var jn={rgb:0,r:null,g:null,b:null,str:""};var Gn={time:0};var Zn={time:0};var tr={time:0};var rr={time:0};var sr={time:0};var Tr={time:0};var Cr={wheel:0};var kr={time:0};mi.prototype={push:function(e){this.content.push(e);this.bubbleUp(this.content.length-1)},pop:function(){var e,t;e=this.content[0];t=this.content.pop();if(this.content.length>0){this.content[0]=t;this.sinkDown(0)}return e},remove:function(e){var t,n,r;t=this.content.length;for(n=0;n<t;n+=1){if(this.content[n]===e){r=this.content.pop();if(n!==t-1){this.content[n]=r;this.bubbleUp(n);this.sinkDown(n)}break}}},size:function(){var e;e=this.content.length;return e},bubbleUp:function(e){var t,n,r,i;t=this.content[e];n=this.scoreFunction(t);while(e>0){r=Math.floor((e+1)/2)-1;i=this.content[r];if(n>=this.scoreFunction(i)){break}this.content[r]=t;this.content[e]=i;e=r}},sinkDown:function(e){var t,n,r,i,s,o,u,a,f,l;t=this.content.length;n=this.content[e];r=this.scoreFunction(n);while(true){s=(e+1)*2;i=s-1;o=null;if(i<t){u=this.content[i];a=this.scoreFunction(u);if(a<r){o=i}}if(s<t){f=this.content[s];l=this.scoreFunction(f);if(l<(o===null?r:a)){o=s}}if(o===null){break}this.content[e]=this.content[o];this.content[o]=n;e=o}},rescore:function(e){this.sinkDown(this.content.indexOf(e))}};var _i={TIME_LABEL:"time",store:{},users:{bmoriarty:1,jamaraldasilva:1,nmbryant:1,tncalvert:1,dadavis:1,ajdegenhardt:1,djdesimone:1,cpgeary:1,jdguerra:1,sjhalloran:1,dlankenau:1,llewis:1,arlocke:1,tslourenco:1,kma:1,zdmason:1,bamiller1:1,baowens:1,jdpham:1,cgporell:1,ijschuba:1,ajtamburri:1,mthompson:1,cttibbetts:1},validID:function(e){return _i.store.hasOwnProperty(e)},validUser:function(e){return _i.users.hasOwnProperty(e)},expand:function(e){var t,n,r;t=Math.floor(e/36e5);e-=t*36e5;n=Math.floor(e/6e4);e-=n*6e4;r=Math.floor(e/1e3);e-=r*1e3;return{h:t,m:n,s:r,ms:e}},tstring:function(e,t){var n,r,i,s;n=_i.expand(e);r="";if(t.h>0){if(n.h<10){r+="0"}r+=n.h+":";if(n.m<10){r+="0"}r+=n.m+":";if(n.s<10){r+="0"}r+=n.s+"."}else if(t.m>0){if(n.m<10){r+="0"}r+=n.m+":";if(n.s<10){r+="0"}r+=n.s+"."}else if(t.s>0){if(n.s<10){r+="0"}r+=n.s+"."}i="";if(n.ms<10){i+="00"}else if(n.ms<100){i+="0"}i+=n.ms.toString();s=i.length;if(s===1){i+="00"}else if(s===2){i+="0"}r+=i;return r},csv:function(e,t){var n,r,i,s,o,u,a,f,l,c,h;n=_i.store[t];r=n.events.length;if(r<1){return Sn(e+"Database '"+t+"' is empty")}i=n.fields.length;s=_i.expand(n.tmax);o=_i.TIME_LABEL+",";a=i-1;for(u=0;u<i;u+=1){f=n.fields[u];o+=f;if(u<a){o+=","}}o+="\r\n";for(u=0;u<r;u+=1){l=n.events[u];o+=_i.tstring(l[_i.TIME_LABEL],s);o+=",";for(c=0;c<i;c+=1){f=n.fields[c];if(l.hasOwnProperty(f)){h=l[f];o+=h.toString()}if(c<a){o+=","}}o+="\r\n"}return o},init:function(e){_i.store[e]={date:Mi(),fields:[],events:[],tmax:0}},erase:function(e){delete _i.store[e]},event:function(e,t){var n,r,i,s,o,u,a;n=_i.store[e];r=new Date;i=r.getTime()-n.date.time;s={};s[_i.TIME_LABEL]=i;n.tmax=i;o=t.length;for(u=0;u<o;u+=2){a=t[u];if(n.fields.indexOf(a)<0){n.fields.push(a)}s[a]=t[u+1]}n.events.push(s);return i},b64Encode:function(e){return window.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},send:function(e,t,n){var r,i,s,o,u,a,f,l;r=false;i=_i.store[t];s=i.events.length;if(s<1){return Sn(e+"Database '"+t+"' is empty")}o=new XMLHttpRequest;if(!o){return Sn(e+"XMLHttpRequest init failed\n")}u=PS.statusText();PS.statusText("Sending data to "+n+" ...");a="";if(i.date.date<10){a+="0"}a+=i.date.date.toString();f=t+"_"+i.date.year+"_"+a+"_"+i.date.monthShort;o.onload=function(){if(r){PS.debug("XMLHttpRequest status: "+o.status+"\nText: "+o.responseText+"\n")}PS.statusText(u)};o.onerror=function(){Sn(e+"XMLHttpRequest status: "+o.status+", text: "+o.responseText);PS.statusText(u)};o.open("POST","https://mandrillapp.com/api/1.0/messages/send.json",true);l=JSON.stringify({key:"Qx68hJAyBFvbhMNRqtX8FQ",message:{from_email:"bmoriarty@wpi.edu",to:[{email:n+"@wpi.edu",name:"User "+n,type:"to"}],autotext:true,subject:"Perlenspiel Report: "+t,html:"Data file attached: "+f+".csv\n",attachments:[{type:"text/plain",name:f+".csv",content:_i.b64Encode(_i.csv(e,t))}]}});try{o.send(l)}catch(c){PS.statusText(u);return En(e+"XMLHttpRequest send failed ["+c.message+"]")}return t}};PS={ALL:"PS.ALL",CURRENT:"PS.CURRENT",DONE:"PS.DONE",DEFAULT:"PS.DEFAULT",ERROR:"PS.ERROR",EMPTY:"PS.EMPTY",UNEQUAL:"PS.UNEQUAL",GRID:"PS.GRID",STATUS:"PS.STATUS",HTML5_AUDIO:"PS.HTML5_AUDIO",WEB_AUDIO:"PS.WEB_AUDIO",SPRITE_TOUCH:"PS.SPRITE_TOUCH",SPRITE_OVERLAP:"PS.SPRITE_OVERLAP",COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ALPHA_OPAQUE:255,ALPHA_TRANSPARENT:0,KEY_ENTER:13,KEY_TAB:9,KEY_ESCAPE:27,KEY_ARROW_LEFT:1005,KEY_ARROW_UP:1006,KEY_ARROW_RIGHT:1007,KEY_ARROW_DOWN:1008,KEY_DELETE:1010,KEY_PAD_0:96,KEY_PAD_1:97,KEY_PAD_2:98,KEY_PAD_3:99,KEY_PAD_4:100,KEY_PAD_5:101,KEY_PAD_6:102,KEY_PAD_7:103,KEY_PAD_8:104,KEY_PAD_9:105,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,WHEEL_FORWARD:"PS.WHEEL_FORWARD",WHEEL_BACKWARD:"PS.WHEEL_BACKWARD",FINDER_ASTAR:"PS.FINDER_ASTAR",FINDER_BREADTH_FIRST:"PS.FINDER_BREADTH_FIRST",FINDER_BEST_FIRST:"PS.FINDER_BEST_FIRST",FINDER_DIJKSTRA:"PS.FINDER_DIJKSTRA",FINDER_BI_ASTAR:"PS.FINDER_BI_ASTAR",FINDER_BI_BEST_FIRST:"PS.FINDER_BI_BEST_FIRST",FINDER_BI_DIJKSTRA:"PS.FINDER_BI_DIJKSTRA",FINDER_BI_BREADTH_FIRST:"PS.FINDER_BI_BREADTH_FIRST",FINDER_JUMP_POINT:"PS.FINDER_JUMP_POINT",_lastTick:0,_clock:function(){if(lt){window.requestAnimationFrame(PS._clock);_n()}},_sys:function(){var n,f,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,A;n="[PS.sys] ";if(!String.fromCodePoint){String.fromCodePoint=en}rt=Math.floor(Math.random()*1e6)+1;X=[];X.length=256;V=[];V.length=256;$=[];$.length=256;J=[];J.length=256;for(f=0;f<256;f+=1){X[f]="rgba("+f+",";V[f]=f+",";$[f]=f+",1)";T=Math.floor(L*f*1e3)/1e3;J[f]=T+")"}Pi();Hi();At=Di();W.inputs.touch=At;document.body.id="body";document.body.style.backgroundColor=z.grid.color.str;p=document.createElement("div");p.id=e;document.body.appendChild(p);K=document.createElement("div");K.id=t;K.style.width=_t+"px";p.appendChild(K);PS._mainLeft=K.offsetLeft;PS._mainTop=K.offsetTop;v=document.createElement("p");v.id=i;v.style.fontSize=Dt;v.style.whiteSpace="nowrap";v.style.display="block";m=document.createTextNode(".");v.appendChild(m);K.appendChild(v);g=document.createElement("p");g.id=s;g.style.fontSize=Dt;g.style.display="none";b=document.createElement("span");b.id=o;y=document.createTextNode("");b.appendChild(y);g.appendChild(b);b=document.createElement("span");b.id=u;w=document.createElement("input");w.id=a;w.type="text";w.tabindex=0;w.wrap="soft";b.appendChild(w);g.appendChild(b);K.appendChild(g);et={statusP:v,statusNode:m,inputP:g,inputNode:y,input:w,fader:Cn(i,fn,null),text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}};Li("Perlenspiel "+W.major+"."+W.minor);G=null;Q=document.createElement("div");Q.style.display="none";Q.style.marginBottom="1.0em";K.appendChild(Q);E=document.createElement("canvas");if(!E){window.alert(n+"HTML5 canvas not supported.");return}E.id=l;E.width=_t;E.style.backgroundColor=z.grid.color.str;E.style.boxShadow="none";Ht=false;ur();K.appendChild(E);S=document.createElement("p");S.id=c;S.style.opacity="1.0";S.innerHTML="Loading Perlenspiel";K.appendChild(S);Ut=S;d=document.createElement("div");d.id=r;K.appendChild(d);It=document.createElement("textarea");It.id=h;It.rows=8;It.wrap="soft";It.readonly="readonly";It.onfocus=function(){Rt=true};It.onblur=function(){Rt=false};It.addEventListener("mousedown",cr,false);It.addEventListener("mouseup",hr,false);d.appendChild(It);qt=false;Rt=false;mt=false;wt=[];gt=[];yt=[];bt=[];for(f=0;f<256;f+=1){wt[f]=0;gt[f]=f;yt[f]=f;bt[f]=f}Et=[];St=false;xt=false;Tt=false;Nt=true;kt=D;Lt=D*5;gt[33]=PS.KEY_PAGE_UP;gt[34]=PS.KEY_PAGE_DOWN;gt[35]=PS.KEY_END;gt[36]=PS.KEY_HOME;gt[37]=PS.KEY_ARROW_LEFT;gt[38]=PS.KEY_ARROW_UP;gt[39]=PS.KEY_ARROW_RIGHT;gt[40]=PS.KEY_ARROW_DOWN;gt[45]=PS.KEY_INSERT;gt[46]=PS.KEY_DELETE;gt[188]=44;gt[190]=46;gt[191]=47;gt[192]=96;gt[219]=91;gt[220]=92;gt[221]=93;gt[222]=39;yt[96]=126;yt[49]=33;yt[50]=64;yt[51]=35;yt[52]=36;yt[53]=37;yt[54]=94;yt[55]=38;yt[56]=42;yt[57]=40;yt[48]=41;yt[45]=95;yt[61]=43;yt[91]=123;yt[93]=125;yt[92]=124;yt[59]=58;yt[39]=34;yt[44]=60;yt[46]=62;yt[47]=63;for(f=65;f<91;f+=1){bt[f]=f+32}bt[126]=96;bt[33]=49;bt[64]=50;bt[35]=51;bt[36]=52;bt[37]=53;bt[94]=54;bt[38]=55;bt[42]=56;bt[40]=57;bt[41]=48;bt[95]=45;bt[43]=51;bt[123]=91;bt[125]=93;bt[124]=92;bt[58]=59;bt[34]=39;bt[60]=44;bt[62]=46;bt[63]=47;window.onblur=wr();x=E.getContext("2d");if(!x.constructor.prototype.fillRoundedRect){x.constructor.prototype.fillRoundedRect=function(e,t,n,r,i,s,o){if(i===undefined){i=5}this.beginPath();if(W.host.app==="Opera"){this.moveTo(e+n-i,t);this.arcTo(e+i,t,e,t+i,i);this.arcTo(e,t+r-i,e+i,t+r,i);this.arcTo(e+n-i,t+r,e+n,t+r-i,i);this.arcTo(e+n,t+i,e+n-i,t,i)}else{this.moveTo(e+i,t);this.arcTo(e+n,t,e+n,t+r,i);this.arcTo(e+n,t+r,e,t+r,i);this.arcTo(e,t+r,e,t,i);this.arcTo(e,t,e+n,t,i)}this.closePath();if(o){this.stroke()}if(s||s===undefined){this.fill()}}}Y={canvas:E,context:x,fader:Cn(l,on,un),width:512,x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:false,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:false,timeExit:0};var O=window.getComputedStyle(Y.canvas,null);Y.padLeft=parseInt(O.getPropertyValue("padding-top").replace("px",""),10);Y.padRight=parseInt(O.getPropertyValue("padding-left").replace("px",""),10);Z=[];Z.length=T=M;for(f=0;f<T;f+=1){N={index:f,fader:Cn(f,ln,null),borderFader:Cn(f,cn,null),glyphFader:Cn(f,hn,null)};qn(N);Z[f]=N}at=[];ft=0;Wt=[];Xt=0;C=null;if(W.host.os!=="iOS"){C=AQ.init({defaultPath:z.audio.path,defaultFileTypes:["ogg","mp3","wav"],onAlert:PS.debug,stack:true,forceHTML5:true});if(C===PS.ERROR||C.status===AQ.ERROR){return}W.audio=C;zt=null;k=PS.audioLoad(z.audio.error_sound,{path:z.audio.path,lock:true});if(k===PS.ERROR){mn("Error sound '"+z.audio.error_sound+"' not loaded")}else{zt=z.audio.error_sound}}st=document.createElement("canvas");x=st.getContext("2d");x.imageSmoothingEnabled=false;x.mozImageSmoothingEnabled=false;x.webkitImageSmoothingEnabled=false;ot=[];ut=0;A="() event function undefined";if(typeof PS.init!=="function"){PS.init=null;mn("PS.init"+A)}if(typeof PS.touch!=="function"){PS.touch=null;mn("PS.touch"+A)}if(typeof PS.release!=="function"){PS.release=null;mn("PS.release"+A)}if(typeof PS.enter!=="function"){PS.enter=null;mn("PS.enter"+A)}if(typeof PS.exit!=="function"){PS.exit=null;mn("PS.exit()"+A)}if(typeof PS.exitGrid!=="function"){PS.exitGrid=null;mn("PS.exitGrid"+A)}if(typeof PS.keyDown!=="function"){PS.keyDown=null;mn("PS.keyDown"+A)}if(typeof PS.keyUp!=="function"){PS.keyUp=null;mn("PS.keyUp"+A)}if(typeof PS.input!=="function"){PS.input=null;mn("PS.input"+A)}if(typeof PS.swipe!=="function"){PS.swipe=null;mn("PS.swipe"+A)}A="PS "+W.major+"."+W.minor+"."+W.revision+" | ";if(C){A+=C.engine+" "+C.major+"."+C.minor+"."+C.revision+" | "}A+=W.host.os+" "+W.host.app+" "+W.host.version;if(At){A+=" | Touch "}S.innerHTML=A;Pr(z.grid.x,z.grid.y);Tn();On();lt=true;ct=0;PS._clock();Mr();Vt=PS.timerStart(6,Kt);if(PS.init){W.date=Mi();try{PS.init(W,{time:ct});dn()}catch(_){En("PS.init() failed ["+_.message+"]",_)}}},gridSize:function(e,t){var n,r,i,s;n="[PS.gridSize] ";if(arguments.length>2){return Sn(n+"Too many arguments")}r=e;i=t;s=z.grid.max;if(r===PS.DEFAULT){r=z.grid.x}else if(r===PS.CURRENT){r=Y.x}else if(Qt(r)==="number"){r=Math.floor(r);if(r<1){r=1}else if(r>s){r=s}}else{return Sn(n+"x argument invalid")}if(i===PS.DEFAULT){i=z.grid.y}else if(i===PS.CURRENT){i=Y.y}else if(Qt(i)==="number"){i=Math.floor(i);if(i<1){i=1}else if(i>s){i=s}}else{return Sn(n+"y argument invalid")}Pr(r,i);return{width:Y.x,height:Y.y}},gridPlane:function(e){var t,n,r;t="[PS.gridPlane] ";if(arguments.length>1){return Sn(t+"Too many arguments")}n=e;r=Qt(n);if(r!=="undefined"&&n!==PS.CURRENT){if(n===PS.DEFAULT){n=0}else if(r==="number"){n=Math.floor(n);if(n<1){n=0}}else{return Sn(t+"plane argument invalid")}Y.plane=n}return Y.plane},gridColor:function(e,t,n){var r,i;r="[PS.gridColor] ";if(arguments.length>3){return Sn(r+"Too many arguments")}i=Fn(r,e,t,n);if(i===PS.ERROR){return PS.ERROR}return _r(i)},gridFade:function(e,t){var n,r,i,s,o,u,a,f;n="[PS.gridFade] ";if(arguments.length>2){return Sn(n+"Too many arguments")}i=Y.color;r=Y.fader;s=r.rate;a=Qt(e);if(a==="undefined"||e===PS.CURRENT){o=s}else if(e===PS.DEFAULT){o=z.fader.rate}else if(a==="number"){o=Math.floor(e);if(o<0){o=0}}else{return Sn(n+"rate argument invalid")}u=qr(n,t);if(u===PS.ERROR){return PS.ERROR}f=u.rgb;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.rgb=z.fader.rgb}else{r.rgb=f}r.r=u.r;r.g=u.g;r.b=u.b}f=u.onStep;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.onStep=z.fader.onStep}else{r.onStep=f}}f=u.onEnd;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.onEnd=z.fader.onEnd}else{r.onEnd=f}}f=u.params;if(f!==PS.CURRENT){if(f===PS.DEFAULT){r.params=z.fader.params}else{r.params=f}}if(s!==o){r.rate=o;if(o<1){r.active=false;r.kill=true}else if(r.active){An(r,i.r,i.g,i.b,255)}}return{rate:r.rate,rgb:r.rgb,onStep:r.onStep,onEnd:r.onEnd,params:r.params}},gridShadow:function(e,t,n,r){var i,s,o;i="[PS.gridShadow] ";if(arguments.length>4){return Sn(i+"Too many arguments")}s=e;if(s!==true&&s!==false&&s!==PS.CURRENT){if(s===null||s===PS.DEFAULT){s=false}else if(Qt(s)==="number"){s=s!==0}else{return Sn(i+"First argument invalid")}}o=Fn(i,t,n,r);if(o===PS.ERROR){return PS.ERROR}return Dr(s,o)},gridRefresh:function(){var e;e="[PS.gridRefresh] ";if(arguments.length>0){return Sn(e+"Too many arguments")}dn();return nt},color:function(e,t,n,r,i){var s,o,u;s="[PS.color] ";o=arguments.length;if(o<2){return Sn(s+"Missing argument(s)")}if(o>5){return Sn(s+"Too many arguments")}u=Fn(s,n,r,i);if(u===PS.ERROR){return PS.ERROR}return jr(s,Fr,e,t,u)},alpha:function(e,t,n){var r,i,s,o;r="[PS.alpha] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=z.bead.color.a}else{return Sn(r+"alpha argument invalid")}}return jr(r,Ir,e,t,s)},fade:function(e,t,n,r){var i,s,o,u,a;i="[PS.fade] ";s=arguments.length;if(s<2){return Sn(i+"Missing argument(s)")}if(s>4){return Sn(i+"Too many arguments")}o=n;if(o!==PS.CURRENT&&o!==PS.DEFAULT){u=Qt(o);if(u==="undefined"){o=PS.CURRENT}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else{return Sn(i+"rate argument invalid")}}a=qr(i,r);if(a===PS.ERROR){return PS.ERROR}return jr(i,Rr,e,t,o,a)},scale:function(e,t,n){var r,i,s,o;r="[PS.scale] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=100}else if(o==="number"){s=Math.floor(s);if(s<50){s=50}else if(s>100){s=100}}else{return Sn(r+"scale parameter invalid")}}return jr(r,Ur,e,t,s)},radius:function(e,t,n){var r,i,s,o;r="[PS.radius] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=0}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>50){s=50}}else{return Sn(r+"radius parameter invalid")}}return jr(r,zr,e,t,s)},bgColor:function(e,t,n,r,i){var s,o,u;s="[PS.bgColor] ";o=arguments.length;if(o<2){return Sn(s+"Missing argument(s)")}if(o>5){return Sn(s+"Too many arguments")}u=Fn(s,n,r,i);if(u===PS.ERROR){return PS.ERROR}return jr(s,Wr,e,t,u)},bgAlpha:function(e,t,n){var r,i,s,o;r="[PS.bgAlpha] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=z.bead.bgColor.a}else{return Sn(r+"alpha argument invalid")}}return jr(r,Xr,e,t,s)},data:function(e,t,n){var r,i,s;r="[PS.data] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s===undefined){s=PS.CURRENT}else if(s===PS.DEFAULT){s=null}return jr(r,Vr,e,t,s)},exec:function(e,t,n){var r,i,s,o;r="[PS.exec] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=z.bead.exec}else if(o!=="function"){return Sn(r+"exec argument invalid")}}return jr(r,$r,e,t,s)},visible:function(e,t,n){var r,i,s;r="[PS.visible] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=Gt(n,PS.CURRENT,true,PS.CURRENT);if(s===PS.ERROR){return Sn(r+"show argument invalid")}return jr(r,Jr,e,t,s)},active:function(e,t,n){var r,i,s;r="[PS.active] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=Gt(n,PS.CURRENT,true,PS.CURRENT);if(s===PS.ERROR){return Sn(r+"active argument invalid")}return jr(r,Kr,e,t,s)},border:function(e,t,n){var r,i,s,o,u,a;r="[PS.border] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=z.bead.border;o=n;if(o!==PS.CURRENT){u=Qt(o);if(u==="undefined"){o=PS.CURRENT}else if(o===PS.DEFAULT){o=s.width}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else if(u==="object"){a=o.top;if(a!==PS.CURRENT){u=Qt(a);if(u==="undefined"){o.top=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.top=a}else if(a===PS.DEFAULT){o.top=s.top}else{return Sn(r+".top property invalid")}}a=o.left;if(a!==PS.CURRENT){u=Qt(a);if(u==="undefined"){o.left=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.left=a}else if(a===PS.DEFAULT){o.left=s.left}else{return Sn(r+".left property invalid")}}a=o.bottom;if(a!==PS.CURRENT){u=Qt(a);if(u==="undefined"){o.bottom=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.bottom=a}else if(a===PS.DEFAULT){o.bottom=s.bottom}else{return Sn(r+".bottom property invalid")}}a=o.right;if(a!==PS.CURRENT){u=Qt(a);if(u==="undefined"){o.right=PS.CURRENT}else if(u==="number"){a=Math.floor(a);if(a<0){a=0}o.right=a}else if(a===PS.DEFAULT){o.right=s.right}else{return Sn(r+".right property invalid")}}}else{return Sn(r+"width argument invalid")}}return jr(r,Qr,e,t,o)},borderColor:function(e,t,n,r,i){var s,o;s="[PS.borderColor] ";if(arguments.length<2){return Sn(s+"Missing argument(s)")}if(arguments.length>5){return Sn(s+"Too many arguments")}o=Fn(s,n,r,i);if(o===PS.ERROR){return PS.ERROR}return jr(s,Gr,e,t,o)},borderAlpha:function(e,t,n){var r,i,s,o;r="[PS.borderAlpha] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=z.bead.border.color.a}else{return Sn(r+"alpha argument invalid")}}return jr(r,Yr,e,t,s)},borderFade:function(e,t,n,r){var i,s,o,u,a;i="[PS.borderFade] ";s=arguments.length;if(s<2){return Sn(i+"Missing argument(s)")}if(s>4){return Sn(i+"Too many arguments")}o=n;if(o!==PS.CURRENT&&o!==PS.DEFAULT){u=Qt(o);if(u==="undefined"){o=PS.CURRENT}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else{return Sn(i+"rate argument not a number")}}a=qr(i,r);if(a===PS.ERROR){return PS.ERROR}return jr(i,Zr,e,t,o,a)},glyph:function(e,t,n){var r,i,s,o;r="[PS.glyph] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(s===PS.DEFAULT){s=0}else if(o==="string"){if(s.length>0){s=s.charCodeAt(0)}else{s=0}}else if(o==="number"){s=Math.floor(s);if(s<1){s=0}}else{return Sn(r+"glyph argument invalid")}}return jr(r,ei,e,t,s)},glyphColor:function(e,t,n,r,i){var s,o;s="[PS.glyphColor] ";if(arguments.length<2){return Sn(s+"Missing argument(s)")}if(arguments.length>5){return Sn(s+"Too many arguments")}o=Fn(s,n,r,i);if(o===PS.ERROR){return PS.ERROR}return jr(s,ti,e,t,o)},glyphAlpha:function(e,t,n){var r,i,s,o;r="[PS.glyphAlpha] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else if(s===PS.DEFAULT){s=z.bead.glyph.color.a}else{return Sn(r+"alpha argument invalid")}}return jr(r,ni,e,t,s)},glyphScale:function(e,t,n){var r,i,s,o;r="[PS.glyphScale] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many arguments")}s=n;if(s!==PS.CURRENT){o=Qt(s);if(o==="undefined"){s=PS.CURRENT}else if(o==="number"){s=Math.floor(s);if(s<50){s=50}else if(s>100){s=100}}else if(s===PS.DEFAULT){s=z.bead.glyph.scale}else{return Sn(r+"scale argument invalid")}}return jr(r,ri,e,t,s)},glyphFade:function(e,t,n,r){var i,s,o,u,a;i="[PS.glyphFade] ";s=arguments.length;if(s<2){return Sn(i+"Missing argument(s)")}if(s>4){return Sn(i+"Too many arguments")}o=n;if(o!==PS.CURRENT&&o!==PS.DEFAULT){u=Qt(o);if(u==="undefined"){o=PS.CURRENT}else if(u==="number"){o=Math.floor(o);if(o<0){o=0}}else{return Sn(i+"rate argument not a number")}}a=qr(i,r);if(a===PS.ERROR){return PS.ERROR}return jr(i,ii,e,t,o,a)},statusText:function(e){var t,n,r;t="[PS.statusText] ";if(arguments.length>1){return Sn(t+"Too many arguments")}n=e;r=Qt(n);if(n!==PS.CURRENT&&r!=="undefined"){if(n===PS.DEFAULT){n=z.status.text}else if(r!=="string"){n=n.toString()}Li(n)}return et.text},statusInput:function(e,t){var n,r,i,s;n="[PS.statusInput] ";if(arguments.length!==2){return Sn(n+"Expected 2 arguments")}if(typeof t!=="function"){return Sn(n+"2nd argument is not a function")}i=e;r=Qt(i);if(r!=="string"){i=i.toString()}s=i.length;if(s>I){i=i.substring(0,I)}Oi(i,t);return et.label},statusColor:function(e,t,n){var r,i,s,o,u,a,f,l,c;r="[PS.statusColor] ";if(arguments.length>3){return Sn(r+"Too many arguments")}i=Fn(r,e,t,n);if(i===PS.ERROR){return PS.ERROR}s=et.color;o=z.status.color;u=et.fader;a=i.rgb;if(a!==PS.CURRENT){if(a===null){f=i.r;if(f===PS.CURRENT){i.r=f=s.r}else if(f===PS.DEFAULT){i.r=f=o.r}l=i.g;if(l===PS.CURRENT){i.g=l=s.g}else if(l===PS.DEFAULT){i.g=l=o.g}c=i.b;if(c===PS.CURRENT){i.b=c=s.b}else if(c===PS.DEFAULT){i.b=c=o.b}i.rgb=f*A+l*O+c}else if(a===PS.DEFAULT){i={r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}if(s.rgb!==i.rgb||u.rate>0&&u.rgb!==null&&u.rgb!==i.rgb){s.rgb=i.rgb;f=i.r;l=i.g;c=i.b;s.str=i.str=X[f]+V[l]+$[c];if(u.rate>0){if(u.rgb!==null){Ln(u,u.r,u.g,u.b,255,f,l,c,255)}if(!u.active){Ln(u,s.r,s.g,s.b,255,f,l,c,255)}else{An(u,f,l,c,255)}}else{fn(s)}s.r=f;s.g=l;s.b=c}}return s.rgb},statusFade:function(e,t){var n,r,i,s,o,u,a,f;n="[PS.statusFade] ";if(arguments.length>2){return Sn(n+"Too many arguments")}i=et.color;r=et.fader;s=r.rate;u=Qt(e);if(u==="undefined"||e===PS.CURRENT){o=s}else if(e===PS.DEFAULT){o=z.fader.rate}else if(u==="number"){o=Math.floor(e);if(o<0){o=0}}else{return Sn(n+"rate argument invalid")}f=qr(n,t);if(f===PS.ERROR){return PS.ERROR}a=f.rgb;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.rgb=z.fader.rgb}else{r.rgb=a}r.r=f.r;r.g=f.g;r.b=f.b}a=f.onStep;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.onStep=z.fader.onStep}else{r.onStep=a}}a=f.onEnd;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.onEnd=z.fader.onEnd}else{r.onEnd=a}}a=f.params;if(a!==PS.CURRENT){if(a===PS.DEFAULT){r.params=z.fader.params}else{r.params=a}}if(s!==o){r.rate=o;if(o<1){r.active=false;r.kill=true}else if(r.active){An(r,i.r,i.g,i.b,255)}}return{rate:r.rate,rgb:r.rgb,onStep:r.onStep,onEnd:r.onEnd,params:r.params}},timerStart:function(e,t){var n,r,i,s,o,u,a,f,l,c;n="[PS.timerStart] ";r=arguments.length;if(r<2){return Sn(n+"Argument(s) missing")}i=e;s=t;if(i===PS.DEFAULT){i=60}else{o=Qt(i);if(o!=="number"){return Sn(n+"ticks argument invalid")}i=Math.floor(i);if(i<1){return Sn(n+"ticks argument less than one (1)")}}if(typeof s!=="function"){return Sn(n+"exec argument not a function")}a=[];if(r>2){l=r-2;a.length=l;for(f=0;f<l;f+=1){a[f]=arguments[f+2]}}c=x+pt;pt+=1;u={id:c,delay:i,count:i,exec:s,arglist:a};ht.push(u);return c},timerStop:function(e){var t,n,r,i,s;t="[PS.timerStop] ";n=arguments.length;if(n<1){return Sn(t+"Argument missing")}if(typeof e!=="string"||e.length<1){return Sn(t+"id argument invalid")}i=ht.length;for(r=0;r<i;r+=1){s=ht[r];if(s.id===e){ht.splice(r,1);return e}}return Sn(t+"timer id '"+e+"' not found")},random:function(e){var t,n,r;t="[PS.random] ";if(arguments.length<1){return Sn(t+"Argument missing")}r=e;if(Qt(r)!=="number"){return Sn(t+"Argument not a number")}r=Math.floor(r);if(r<2){return 1}n=function(){var e;e=Math.sin(rt)*1e4;rt+=1;return e-Math.floor(e)};r=n()*r;r=Math.floor(r)+1;return r},seed:function(e){var t,n;t="[PS.seed] ";if(arguments.length<1){return Sn(t+"Argument missing")}n=e;if(Qt(n)!=="number"){return Sn(t+"Argument not a number")}n=Math.floor(n);if(n<1){n=1}rt=n;return rt},makeRGB:function(e,t,n){var r,i,s,o,u;r="[PS.makeRGB] ";i=arguments.length;if(i<3){return Sn(r+"Argument(s) missing")}if(i>3){return Sn(r+"Too many arguments")}s=e;o=t;u=n;if(Qt(s)!=="number"){return Sn(r+"r argument not a number")}s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}if(Qt(o)!=="number"){return Sn(r+"g argument not a number")}o=Math.floor(o);if(o<0){o=0}else if(o>255){o=255}if(Qt(u)!=="number"){return Sn(r+"b argument not a number")}u=Math.floor(u);if(u<0){u=0}else if(u>255){u=255}return s*A+o*O+u},unmakeRGB:function(e,t){var n,r,i,s,o,u,a,f,l,c;n="[PS.unmakeRGB] ";r=arguments.length;if(r<2){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many arguments")}i=e;s=t;if(Qt(i)!=="number"){return Sn(n+"rgb argument not a number")}i=Math.floor(i);if(i<1){i=0;o=0;u=0;a=0}else if(i>=16777215){i=16777215;o=255;u=255;a=255}else{o=i/A;o=Math.floor(o);f=o*A;u=(i-f)/O;u=Math.floor(u);l=u*O;a=i-f-l}c=Qt(s);if(c==="object"){s.rgb=i;s.r=o;s.g=u;s.b=a}else if(c==="array"){if(s.length<3){s.length=3}s[0]=o;s[1]=u;s[2]=a}else{return Sn(n+"result argument not an array or object reference")}return s},applyRect:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;s="[PS.applyRect] ";o=arguments.length;if(o<5){return Sn(s+"Argument(s) missing")}u=Y.x;a=Y.y;f=e;l=t;c=n;h=r;p=i;if(f===PS.DEFAULT){f=0}else if(Qt(f)==="number"){f=Math.floor(f);if(f>=u){return PS.DONE}if(f<0){f=0}}else{return Sn(s+"left argument invalid")}if(l===PS.DEFAULT){l=0}else if(Qt(l)==="number"){l=Math.floor(l);if(l>=a){return PS.DONE}if(l<0){l=0}}else{return Sn(s+"top argument invalid")}if(c===PS.DEFAULT){c=u-f}else if(Qt(c)==="number"){c=Math.floor(c);if(c<1){return PS.DONE}if(f+c>u){c=u-f}}else{return Sn(s+"width argument invalid")}d=f+c;if(h===PS.DEFAULT){h=a-l}else if(Qt(h)==="number"){h=Math.floor(h);if(h<1){return PS.DONE}if(l+h>a){h=a-l}}else{return Sn(s+"height argument invalid")}v=l+h;if(!p||typeof p!=="function"){return Sn(s+"exec argument not a function")}b=[0,0];if(o>5){w=o-5;for(E=0;E<w;E+=1){b.push(arguments[E+5])}}for(g=l;g<v;g+=1){b[1]=g;for(m=f;m<d;m+=1){b[0]=m;try{y=p.apply(_,b)}catch(S){y=En(s+"exec failed @"+m+", "+g+" ["+S.message+"]",S)}if(y===PS.ERROR){return PS.ERROR}}}return y},hex:function(e,t){var n,r,i,s;n="[PS.hex] ";r=e;i=Qt(r);if(i!=="number"){return Sn(n+"value argument invalid")}r=Math.floor(r);r=Math.abs(r);s=t;i=Qt(s);if(i==="undefined"||s===PS.DEFAULT){s=2}else if(i==="number"){s=Math.floor(s);if(s<1){s=1}}else{return Sn(n+"padding argument invalid")}return fi(r,s)},keyRepeat:function(e,t,n){var r,i,s,o,u;r="[PS.keyRepeat] ";s=Gt(e,Nt,true,true);if(s===PS.ERROR){return Sn(r+"repeat argument invalid")}u=t;i=Qt(u);if(i==="undefined"||u===PS.DEFAULT){u=D*5}else if(u===PS.CURRENT){u=Lt}else if(i==="number"){u=Math.floor(u);if(u<1){u=1}}else{return Sn(r+"init argument invalid")}o=n;i=Qt(o);if(i==="undefined"||o===PS.DEFAULT){o=D}else if(o===PS.CURRENT){o=kt}else if(i==="number"){o=Math.floor(o);if(o<1){o=1}}else{return Sn(r+"delay argument invalid")}Nt=s;Lt=u;kt=o;return{repeat:Nt,init:Lt,delay:kt}},date:function(){return Mi()},elapsed:function(){var e,t;e=new Date;t=e.getTime();return t-W.date.time},imageLoad:function(e,t,n){var r,i,s,o,u,a,f,l,c;r="[PS.imageLoad] ";i=arguments.length;if(i<2){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many argument(s)")}s=e;o=t;u=n;if(typeof s!=="string"||s.length<1){return Sn(r+"filename argument invalid")}a=s.substr(s.lastIndexOf(".")+1);a=a.toLowerCase();if(a!=="png"&&a!=="jpg"&&a!=="jpeg"&&a!=="bmp"){return Sn(r+"filename extension invalid")}if(typeof o!=="function"){return Sn(r+"exec argument invalid")}c=Qt(u);if(c==="undefined"||u===PS.DEFAULT){u=4}else{if(c!=="number"){return Sn(r+"format argument invalid")}u=Math.floor(u);if(u<1&&u>4){return Sn(r+"format argument is not 1, 2, 3 or 4")}}l=w+ut;ut+=1;ot.push({source:s,id:l,exec:o,format:u});try{f=new Image;f.setAttribute("data-id",l);f.onload=function(){ui(f)};f.onerror=function(){si(f)};f.src=s}catch(h){return En(r+"Error loading "+s+" ["+h.message+"]",h)}return l},imageBlit:function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,M,_,D,P,H,B,j,F,I,q,R,U;i="[PS.imageBlit] ";s=arguments.length;if(s<3){return Sn(i+"Missing argument(s)")}if(s>4){return Sn(i+"Too many arguments")}o=Y.x;u=Y.y;a=e;f=t;l=n;c=r;if(ai(i,a)===PS.ERROR){return PS.ERROR}h=a.width;p=a.height;d=a.pixelSize;v=a.data;m=Qt(f);if(m==="undefined"||f===PS.DEFAULT){f=0}else if(m==="number"){f=Math.floor(f)}else{return Sn(i+"xpos argument invalid")}m=Qt(l);if(m==="undefined"||l===PS.DEFAULT){l=0}else if(m==="number"){l=Math.floor(l)}else{return Sn(i+"ypos argument invalid")}if(f>=o||l>=u||f+h<1||l+p<1){return false}m=Qt(c);if(m==="undefined"||c===PS.DEFAULT){g=0;y=0;b=h;w=p}else if(m==="object"){y=c.left;m=Qt(y);if(m==="undefined"||y===PS.DEFAULT){y=0}else{if(m!=="number"){return Sn(i+"region.left invalid")}y=Math.floor(y);if(y<0){y=0}else if(y>=h){return Sn(i+"region.left outside image")}}g=c.top;m=Qt(g);if(m==="undefined"||g===PS.DEFAULT){g=0}else{if(m!=="number"){return Sn(i+"region.top invalid")}g=Math.floor(g);if(g<0){g=0}else if(g>=p){return Sn(i+"region.top outside image")}}b=c.width;m=Qt(b);if(m==="undefined"||b===PS.DEFAULT){b=h-y}else{if(m!=="number"){return Sn(i+"region.width invalid")}b=Math.floor(b);if(b<1){return false}if(y+b>h){b=h-y}}if(f+b<1){return false}w=c.height;m=Qt(w);if(m==="undefined"||w===PS.DEFAULT){w=p-g}else{if(m!=="number"){return Sn(i+"region.height invalid")}w=Math.floor(w);if(w<1){return false}if(g+w>p){w=p-g}}if(l+w<1){return false}}else{return Sn(i+"region argument invalid")}if(f<0){b+=f;if(b<1){return false}y-=f;f=0}S=f+b;if(S>o){b=o-f}if(b<1){return false}if(l<0){w+=l;if(w<1){return false}g-=l;l=0}S=l+w;if(S>u){w=u-l}if(w<1){return false}x=h*d;U=false;H=255;E=Y.plane;T=g*x+y*d;k=l;for(L=0;L<w;L+=1){N=T;C=f;for(M=0;M<b;M+=1){I=C+k*o;q=Z[I];if(q.active){U=true;if(d<3){B=v[N];_=B/A;_=Math.floor(_);j=_*A;D=(B-j)/O;D=Math.floor(D);F=D*O;P=B-j-F;if(d===2){H=v[N+1]}}else{_=v[N];D=v[N+1];P=v[N+2];B=_*A+D*O+P;if(d===4){H=v[N+3]}}R=Rn(q,E);R.r=_;R.g=D;R.b=P;R.a=H;R.rgb=B;Pn(q)}C+=1;N+=d}k+=1;T+=x}if(U){dn()}return true},imageCapture:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,E,S,x,T,N;n="[PS.imageCapture] ";r=arguments.length;if(r>2){return Sn(n+"Too many arguments")}i=e;s=t;o=Qt(i);if(o==="undefined"||i===PS.DEFAULT){i=3}else{if(o!=="number"){return Sn(n+"format argument invalid")}i=Math.floor(i);if(i<1&&i>4){return Sn(n+"format argument is not 1, 2, 3 or 4")}}u=Y.x;a=Y.y;o=Qt(s);if(o==="undefined"||s===PS.DEFAULT){l=0;c=0;h=u;p=a}else if(o==="object"){c=s.left;o=Qt(c);if(o==="undefined"||c===PS.DEFAULT){c=0}else{if(o!=="number"){return Sn(n+"region.left not a number")}c=Math.floor(c);if(c<0){c=0}else if(c>=u){return Sn(n+"region.left outside grid")}}l=s.top;o=Qt(l);if(o==="undefined"||l===PS.DEFAULT){l=0}else{if(o!=="number"){return Sn(n+"region.top not a number")}l=Math.floor(l);if(l<0){l=0}else if(l>=a){return Sn(n+"region.top outside grid")}}h=s.width;o=Qt(h);if(o==="undefined"||h===PS.DEFAULT){h=u-c}else{if(o!=="number"){return Sn(n+"region.width not a number")}h=Math.floor(h);if(h<1||c+h>u){h=u-c}}p=s.height;o=Qt(p);if(o==="undefined"||p===PS.DEFAULT){p=a-l}else{if(o!=="number"){return Sn(n+"region.height not a number")}p=Math.floor(p);if(p<1||l+p>a){p=a-l}}}else{return Sn(n+"region argument invalid")}y=w+ut;ut+=1;v={source:PS.GRID,id:y,width:h,height:p,pixelSize:i,valid:true,data:[]};d=h*p;if(d<1){return v}f=v.data;f.length=d*i;m=c+h;g=l+p;b=0;for(S=l;S<g;S+=1){for(E=c;E<m;E+=1){x=E+S*u;T=Z[x];N=T.color;if(i<3){f[b]=N.rgb;if(i===2){f[b+1]=N.a}}else{f[b]=N.r;f[b+1]=N.g;f[b+2]=N.b;if(i===4){f[b+3]=N.a}}b+=i}}return v},imageDump:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,M,_,D,P,H,B,j,F;s="[PS.imageDump] ";o=arguments.length;if(o<1){return Sn(s+"Missing argument(s)")}if(o>5){return Sn(s+"Too many arguments")}u=e;a=t;f=n;l=r;if(ai(s,u)===PS.ERROR){return PS.ERROR}h=u.width;p=u.height;d=u.pixelSize;v=u.data;m=Qt(a);if(m==="undefined"||a===PS.DEFAULT){g=0;y=0;b=h;w=p}else if(m==="object"){y=a.left;m=Qt(y);if(m==="undefined"||y===PS.DEFAULT){y=0}else{if(m!=="number"){return Sn(s+"region.left invalid")}y=Math.floor(y);if(y<0){y=0}else if(y>=h){return Sn(s+"region.left outside grid")}}g=a.top;m=Qt(g);if(m==="undefined"||g===PS.DEFAULT){g=0}else{if(m!=="number"){return Sn(s+"region.top invalid")}g=Math.floor(g);if(g<0){g=0}else if(g>=p){return Sn(s+"region.top outside grid")}}b=a.width;m=Qt(b);if(m==="undefined"||b===PS.DEFAULT){b=h-y}else{if(m!=="number"){return Sn(s+"region.width invalid")}b=Math.floor(b);if(b<1||y+b>h){b=h-y}}w=a.height;m=Qt(w);if(m==="undefined"||w===PS.DEFAULT){w=p-g}else{if(m!=="number"){return Sn(s+"region.height invalid")}w=Math.floor(w);if(w<1||g+w>p){w=p-g}}}else{return Sn(s+"region argument invalid")}E=b*w;m=Qt(f);if(m==="undefined"||f===PS.DEFAULT){f=d}else{if(m!=="number"){return Sn(s+"format argument invalid")}f=Math.floor(f);if(f<1||f>4){return Sn(s+"format argument is not 1, 2, 3 or 4")}}m=Qt(l);if(m==="undefined"||l===PS.DEFAULT){l=b}else{if(m!=="number"){return Sn(s+"length argument invalid")}l=Math.floor(l);if(l<1){l=1}if(l>E){l=E}}c=Gt(i,PS.ERROR,true,true);if(c===PS.ERROR){return Sn(s+"hex argument invalid")}S="\nvar myImage = {\n	width : "+b+", height : "+w+", pixelSize : "+f+",\n	data : [";if(E<1){S+="]\n};\n";PS.debug(S);return PS.DONE}S+="\n	";C=255;N=T=0;x=h*d;k=g*x+y*d;for(M=0;M<w;M+=1){L=k;for(_=0;_<b;_+=1){if(d<3){B=v[L];if(B<1){D=P=H=0}else if(B>=16777215){D=P=H=255}else{D=B/A;D=Math.floor(D);j=D*A;P=(B-j)/O;P=Math.floor(P);F=P*O;H=B-j-F}if(d===2){C=v[L+1]}}else{D=v[L];P=v[L+1];H=v[L+2];B=D*A+P*O+H;if(d===4){C=v[L+3]}}S+=li(f,c,B,D,P,H,C);N+=1;if(N<E){S+=",";T+=1;if(T<l){S+=" "}else{T=0;S+="\n	"}}L+=d}k+=x}S+="\n	]\n};\n";PS.debug(S);return PS.DONE},spriteSolid:function(e,t){var n,r,i,s,o;n="[PS.spriteSolid] ";r=arguments.length;if(r<2){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many argument(s)")}i=e;s=t;if(i===PS.DEFAULT){i=1}else if(Qt(i)==="number"){i=Math.floor(i);if(i<1){i=1}}else{return Sn(n+"width argument invalid")}if(s===PS.DEFAULT){s=1}else if(Qt(s)==="number"){s=Math.floor(s);if(s<1){s=1}}else{return Sn(n+"height argument invalid")}o=ci();o.width=i;o.height=s;o.color={rgb:0,r:0,g:0,b:0,a:255};return o.id},spriteSolidColor:function(e,t,n,r){var i,s,o,u,a,f,l,c,h;i="[PS.spriteSolidColor] ";s=arguments.length;if(s<1){return Sn(i+"Missing argument(s)")}if(s>4){return Sn(i+"Too many argument(s)")}o=hi(e,i);if(o===PS.ERROR){return PS.ERROR}a=o.color;if(!a){return Sn(i+"Cannot set color of image sprite "+o.id)}u=Fn(i,t,n,r);if(u===PS.ERROR){return PS.ERROR}f=u.rgb;if(f!==PS.CURRENT){if(f===null){l=u.r;if(l===PS.CURRENT){u.r=l=a.r}else if(l===PS.DEFAULT){u.r=l=0}c=u.g;if(c===PS.CURRENT){u.g=c=a.g}else if(c===PS.DEFAULT){u.g=c=0}h=u.b;if(h===PS.CURRENT){u.b=h=a.b}else if(h===PS.DEFAULT){u.b=h=0}u.rgb=f=l*A+c*O+h}else if(f===PS.DEFAULT){u.rgb=f=0;u.r=0;u.g=0;u.b=0}if(a.rgb!==f){a.rgb=f;a.r=u.r;a.g=u.g;a.b=u.b;if(o.visible&&o.placed){di(o);dn()}}}return a.rgb},spriteSolidAlpha:function(e,t){var n,r,i,s,o,u,a;n="[PS.spriteSolidAlpha] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many argument(s)")}i=e;s=t;o=hi(i,n);if(o===PS.ERROR){return PS.ERROR}u=o.color;if(!u){return Sn(n+"Cannot set alpha of image sprite "+o.id)}a=Qt(s);if(a!=="undefined"&&s!==PS.CURRENT){if(s===PS.DEFAULT){s=255}else if(a==="number"){s=Math.floor(s);if(s<0){s=0}else if(s>255){s=255}}else{return Sn(n+"alpha argument invalid")}if(u.a!==s){u.a=s;if(o.visible&&o.placed){di(o);dn()}}}return u.a},spriteImage:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,E,S,x,T,N,C,k,L;n="[PS.spriteImage] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many argument(s)")}if(ai(n,e)===PS.ERROR){return PS.ERROR}l=f=0;c=i=e.width;h=s=e.height;o=e.pixelSize;u=e.data;a=Qt(t);if(a!=="undefined"&&t!==PS.DEFAULT){if(a!=="object"){return Sn(n+"region argument invalid")}l=t.left;a=Qt(l);if(a==="undefined"||l===PS.DEFAULT){l=0}else{if(a!=="number"){return Sn(n+"region.left invalid")}l=Math.floor(l);if(l<0){l=0}else if(l>=i){return Sn(n+"region.left outside image")}}f=t.top;a=Qt(f);if(a==="undefined"||f===PS.DEFAULT){f=0}else{if(a!=="number"){return Sn(n+"region.top invalid")}f=Math.floor(f);if(f<0){f=0}else if(f>=s){return Sn(n+"region.top outside image")}}c=t.width;a=Qt(c);if(a==="undefined"||c===PS.DEFAULT){c=i-l}else{if(a!=="number"){return Sn(n+"region.width invalid")}c=Math.floor(c);if(c<1||l+c>i){c=i-l}}h=t.height;a=Qt(h);if(a==="undefined"||h===PS.DEFAULT){h=s-f}else{if(a!=="number"){return Sn(n+"region.height invalid")}h=Math.floor(h);if(h<1||f+h>s){h=s-f}}}p=[];p.length=c*h*4;N=255;d=i*o;v=f*d+l*o;b=0;for(y=0;y<h;y+=1){m=v;for(g=0;g<c;g+=1){if(o<3){E=u[m];if(E<1){E=S=x=T=0}else if(E>=16777215){E=16777215;S=x=T=255}else{S=E/A;S=Math.floor(S);C=S*A;x=(E-C)/O;x=Math.floor(x);k=x*O;T=E-C-k}if(o===2){N=u[m+1]}}else{S=u[m];x=u[m+1];T=u[m+2];if(o===4){N=u[m+3]}}p[b]=S;p[b+1]=x;p[b+2]=T;p[b+3]=N;m+=o;b+=4}v+=d}L=ci();L.width=c;L.height=h;L.image={id:w+ut,width:c,height:h,pixelSize:4,data:p};ut+=1;return L.id},spriteShow:function(e,t){var n,r,i,s,o;n="[PS.spriteShow] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many argument(s)")}i=e;o=hi(i,n);if(o===PS.ERROR){return PS.ERROR}s=Gt(t,PS.CURRENT,true,PS.CURRENT);if(s===PS.ERROR){return Sn(n+"show argument invalid")}if(s!==PS.CURRENT){if(o.visible!==s){o.visible=s;if(o.placed){if(s){di(o);vi(o,i)}else{pi(o)}dn()}}}return o.visible},spriteAxis:function(e,t,n){var r,i,s,o,u,a,f;r="[PS.spriteAxis] ";i=arguments.length;if(i<1){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many argument(s)")}s=e;o=t;u=n;a=hi(s,r);if(a===PS.ERROR){return PS.ERROR}f=Qt(o);if(f==="undefined"||o===PS.CURRENT){o=a.ax}else if(o===PS.DEFAULT){o=0}else if(f==="number"){o=Math.floor(o)}else{return Sn(r+"x argument invalid")}f=Qt(u);if(f==="undefined"||u===PS.CURRENT){u=a.ay}else if(u===PS.DEFAULT){u=0}else if(f==="number"){u=Math.floor(u)}else{return Sn(r+"y argument invalid")}if(o!==a.ax||u!==a.ay){a.ax=o;a.ay=u;if(a.visible&&a.placed){di(a);vi(a,s);dn()}}return{x:a.ax,y:a.ay}},spritePlane:function(e,t){var n,r,i,s,o,u;n="[PS.spritePlane] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many arguments")}i=e;s=t;o=hi(i,n);if(o===PS.ERROR){return PS.ERROR}u=Qt(s);if(u!=="undefined"&&s!==PS.CURRENT){if(s===PS.DEFAULT){s=0}else if(u==="number"){s=Math.floor(s);if(s<1){s=0}}else{return Sn(n+"plane argument invalid")}if(o.plane!==s){if(o.visible&&o.placed){pi(o)}o.plane=s;if(o.visible&&o.placed){di(o);dn()}}}if(o.plane<0){return 0}return o.plane},spriteMove:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;r="[PS.spriteMove] ";i=arguments.length;if(i<1){return Sn(r+"Missing argument(s)")}if(i>3){return Sn(r+"Too many argument(s)")}s=e;o=t;u=n;a=hi(s,r);if(a===PS.ERROR){return PS.ERROR}f=Qt(o);if(f==="undefined"||o===PS.CURRENT){o=a.x}else if(o===PS.DEFAULT){o=0}else if(f==="number"){o=Math.floor(o)}else{return Sn(r+"x argument invalid")}f=Qt(u);if(f==="undefined"||u===PS.CURRENT){u=a.y}else if(u===PS.DEFAULT){u=0}else if(f==="number"){u=Math.floor(u)}else{return Sn(r+"y argument invalid")}if(!a.placed||o!==a.x||u!==a.y){y=false;if(a.plane<0){a.plane=Y.plane}if(a.visible&&a.placed){c=a.y;p=a.height;if(o>a.x){h=o-a.x;l=a.x}else if(a.x>o){h=a.x-o;l=a.x+a.width-h}else{h=0}if(h>=a.width){y=true;pi(a)}else{d=a.x;m=a.width;if(u>a.y){g=u-a.y;v=a.y}else if(a.y>u){g=a.y-u;v=a.y+a.height-g}else{g=0}if(g>=a.height){y=true;pi(a)}else if(g<1){y=true;pi(a,l,c,h,p)}else if(m<1){y=true;pi(a,d,v,m,g)}else{y=true;m-=h;if(o>a.x){d+=h}pi(a,l,c,h,p);pi(a,d,v,m,g)}}}a.x=o;a.y=u;a.placed=true;if(a.visible){y=true;di(a);vi(a,s)}if(y){dn()}}return{x:a.x,y:a.y}},spriteCollide:function(e,t){var n,r,i,s,o;n="[PS.spriteCollide] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many arguments")}i=hi(e,n);if(i===PS.ERROR){return PS.ERROR}s=t;o=Qt(s);if(o!=="undefined"&&s!==PS.CURRENT){if(s===PS.DEFAULT){s=null}else if(o!=="function"){return Sn(n+"exec argument not a function")}if(i.collide!==s){i.collide=s;if(s&&i.visible&&i.placed){vi(i,e)}}}return i.collide},spriteDelete:function(e){var t,n,r,i,s;t="[PS.spriteDelete] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument")}if(n>1){return Sn(t+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(t+"sprite argument invalid")}r=at.length;for(i=0;i<r;i+=1){s=at[i];if(s.id===e){pi(s);at.splice(i,1);dn();return PS.DONE}}return Sn(t+"sprite id '"+e+"' not found")},audioLoad:function(e,t){var n,r;n="[PS.audioLoad] ";if(arguments.length<1){return Sn(n+"Missing argument(s)")}if(arguments.length>2){return Sn(n+"Too many arguments")}r=AQ.load(e,t);if(r===AQ.ERROR){return PS.ERROR}return r},audioPlay:function(e,t){var n,r,i,s,o,u;n="[PS.audioPlay] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many arguments")}i=e;s=t;o=Qt(s);if(o==="undefined"){s={}}else if(o!=="object"){return Sn(n+"params argument invalid")}s.autoplay=true;u=AQ.load(i,s);if(u===AQ.ERROR){return PS.ERROR}return u},audioPause:function(e){var t,n,r;t="[PS.audioPause] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument(s)")}if(n>1){return Sn(t+"Too many arguments")}r=AQ.pause(e);if(r===AQ.ERROR){return PS.ERROR}return r},audioStop:function(e){var t,n,r;t="[PS.audioStop] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument(s)")}if(n>1){return Sn(t+"Too many arguments")}r=AQ.stop(e);if(r===AQ.ERROR){return PS.ERROR}if(r===AQ.DONE){return PS.DONE}return r},piano:function(e,t){var n,r,i,s,o,u;n="[PS.piano] ";r=q.length;s=e;i=Qt(s);if(i!=="number"){return Sn(n+"index argument invalid")}s=Math.floor(s);if(s<1){s=1}else if(s>r){s=r}o=t;if(o!==true&&o!==false){i=Qt(o);if(i==="undefined"){o=false}else if(i!=="number"){return Sn(n+"flag argument invalid")}}u="piano_"+q[s-1];if(o){u="l_"+u}return u},harpsichord:function(e,t){var n,r,i,s,o,u;n="[PS.harpsichord] ";r=R.length;s=e;i=Qt(s);if(i!=="number"){return Sn(n+"index argument invalid")}s=Math.floor(s);if(s<1){s=1}else if(s>r){s=r}o=t;if(o!==true&&o!==false){i=Qt(o);if(i==="undefined"){o=false}else if(i!=="number"){return Sn(n+"flag argument invalid")}}u="hchord_"+R[s-1];if(o){u="l_"+u}return u},xylophone:function(e){var t,n,r,i,s;t="[PS.xylophone] ";n=U.length;i=e;r=Qt(i);if(r!=="number"){return Sn(t+"index argument invalid")}i=Math.floor(i);if(i<1){i=1}else if(i>n){i=n}s="xylo_"+U[i-1];return s},debug:function(e){var t,n,r,i;t="[PS.debug] ";if(arguments.length>1){return Sn(t+"Too many arguments")}n=e;r=Qt(n);if(r==="undefined"){n=""}else if(r!=="string"){n=n.toString()}vn();if(n.length>0){i=document.getElementById(h);i.value+=n;i.scrollTop=i.scrollHeight;if(console&&console.log){console.log(n)}}xn();return PS.DONE},debugClose:function(){var e,t;e="[PS.debugClose] ";if(arguments.length>0){return Sn(e+"Too many arguments")}t=document.getElementById(r);t.style.display="none";qt=false;return PS.DONE},debugClear:function(){var e;e="[PS.debugClear] ";if(arguments.length>0){return Sn(e+"Too many arguments")}It.value="";return PS.DONE},line:function(e,t,n,r){var i,s,o,u,a,f,l;i="[PS.line] ";s=arguments.length;if(s<4){return Sn(i+"Missing argument(s)")}if(s>4){return Sn(i+"Too many arguments")}o=e;u=t;a=n;f=r;if(Qt(o)==="number"){o=Math.floor(o)}else{return Sn(i+"x1 argument not a number")}if(Qt(u)==="number"){u=Math.floor(u)}else{return Sn(i+"y1 argument not a number")}if(Qt(a)==="number"){a=Math.floor(a)}else{return Sn(i+"x2 argument not a number")}if(Qt(f)==="number"){f=Math.floor(f)}else{return Sn(i+"y2 argument not a number")}l=gi(o,u,a,f);return l},pathMap:function(e){var t,n,r;t="[PS.pathMap] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument(s)")}if(n>1){return Sn(t+"Too many arguments")}if(ai(t,e)===PS.ERROR){return PS.ERROR}if(e.pixelSize!==1){return Sn(t+"image is not format 1")}r=Ti(e.width,e.height,e.data);return r.id},pathFind:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b;o="[PS.pathFind] ";u=arguments.length;if(u<5){return Sn(o+"Missing argument(s)")}if(u>6){return Sn(o+"Too many arguments")}a=e;f=t;l=n;c=r;h=i;p=s;if(typeof a!=="string"||a.length<1){return Sn(o+"pathmap argument invalid")}d=Ni(a);if(!d){return Sn(o+a+" not found")}if(Qt(f)==="number"){f=Math.floor(f);if(f<0||f>=d.width){return Sn(o+"x1 argument is outside "+a)}}else{return Sn(o+"x1 argument not a number")}if(Qt(l)==="number"){l=Math.floor(l);if(l<0||l>=d.height){return Sn(o+"y1 argument is outside "+a)}}else{return Sn(o+"y1 argument not a number")}if(Qt(c)==="number"){c=Math.floor(c);if(c<0||c>=d.width){return Sn(o+"x2 argument is outside "+a)}}else{return Sn(o+"x2 argument not a number")}if(Qt(h)==="number"){h=Math.floor(h);if(h<0||h>=d.height){return Sn(o+"y2 argument is outside "+a)}}else{return Sn(o+"y2 argument not a number")}y=false;b=false;v=Qt(p);if(v!=="undefined"&&p!==PS.DEFAULT){if(v!=="object"){return Sn(o+"options argument invalid")}g=p.no_diagonals;if(g===true||g===false){y=g}else{v=Qt(g);if(v==="undefined"||g===PS.DEFAULT){y=false}else if(v==="number"){y=g!==0}else{return Sn(o+"options.no_diagonals invalid")}}g=p.cut_corners;if(g===true||g===false){b=g}else{v=Qt(g);if(v==="undefined"||g===PS.DEFAULT){b=false}else if(v==="number"){b=g!==0}else{return Sn(o+"options.cut_corners invalid")}}}m=Si(d,f,l,c,h,y,b);return m},pathData:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g;o="[PS.pathData] ";u=arguments.length;if(u<5){return Sn(o+"Missing argument(s)")}if(u>6){return Sn(o+"Too many arguments")}a=e;f=t;l=n;c=r;h=i;p=s;if(typeof a!=="string"||a.length<1){return Sn(o+"pathmap argument invalid")}d=Ni(a);if(!d){return Sn(o+a+" not found")}if(Qt(f)==="number"){f=Math.floor(f);if(f<0||f>=d.width){return Sn(o+"left argument is outside "+a)}}else{return Sn(o+"left argument not a number")}if(Qt(l)==="number"){l=Math.floor(l);if(l<0||l>=d.height){return Sn(o+"top argument is outside "+a)}}else{return Sn(o+"top argument not a number")}if(c===PS.DEFAULT){c=1}else if(Qt(c)==="number"){c=Math.floor(c);if(c<1){c=1}else{v=d.width-f;if(c>v){c=v}}}else{return Sn(o+"width argument not a number")}if(h===PS.DEFAULT){h=1}else if(Qt(h)==="number"){h=Math.floor(h);if(h<1){h=1}else{v=d.height-l;if(h>v){h=v}}}else{return Sn(o+"height argument not a number")}if(p!==PS.DEFAULT&&p!==PS.CURRENT){m=Qt(p);if(m==="undefined"){p=PS.CURRENT}else if(m==="number"){if(p<0){return Sn(o+"data argument < 0")}}else{return Sn(o+"data argument not a number")}}g=xi(d,f,l,c,h,p);return g},pathDelete:function(e){var t,n;t="[PS.pathDelete] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument")}if(typeof e!=="string"||e.length<1){return Sn(t+"pathmap argument invalid")}if(!Ci(e)){return Sn(t+e+" not found")}return PS.DONE},pathNear:function(e,t,n,r,i){var s,o,u,a;s="[PS.pathNear] ";o=arguments.length;if(o<5){return Sn(s+"Missing argument(s)")}if(o>5){return Sn(s+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(s+"pathmap argument invalid")}u=Ni(e);if(!u){return Sn(s+e+" not found")}a=ki(u,t,n,r,i);return a},dbInit:function(e){var t,n;t="[PS.dbInit] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument")}if(n>1){return Sn(t+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(t+"Database id invalid")}e=e.toLowerCase();if(e===_i.TIME_LABEL){return Sn(t+"Database id '"+_i.TIME_LABEL+"' is reserved")}if(_i.validID(e)){return Sn(t+"Database id '"+e+"' already exists")}_i.init(e);return e},dbErase:function(e){var t,n;t="[PS.dbErase] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument")}if(n>1){return Sn(t+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(t+"Database id invalid")}e=e.toLowerCase();if(!_i.validID(e)){return Sn(t+"Database id '"+e+"' does not exist")}_i.erase(e);return e},dbEvent:function(e){var t,n,r,i,s,o,u,a,f;t="[PS.dbEvent] ";n=arguments.length;if(n<3){return Sn(t+"Missing arguments")}if(typeof e!=="string"||e.length<1){return Sn(t+"Database id invalid")}e=e.toLowerCase();if(!_i.validID(e)){return Sn(t+"Database id '"+e+"' does not exist")}i={};s=[];r=1;while(r<n){o=arguments[r];if(typeof o!=="string"||o.length<1){return Sn(t+"Event name @ argument "+r+" invalid")}o=o.toLowerCase();if(o===_i.TIME_LABEL){return Sn(t+"Event label '"+_i.TIME_LABEL+"' is reserved")}if(i.hasOwnProperty(o)){return Sn(t+"Duplicate event '"+o+"' @ argument "+r)}i[o]=true;u=r+1;if(u>=n){return Sn(t+"Missing value for event '"+o+"'")}s.push(o);a=arguments[u];f=Qt(a);if(f!=="number"&&f!=="string"&&a!==true&&a!==false&&a!==null){return Sn(t+"Illegal value type for event '"+o+"'")}s.push(a);r+=2}return _i.event(e,s)},dbData:function(e){var t,n;t="[PS.dbData] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument")}if(n>1){return Sn(t+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(t+"Database id invalid")}e=e.toLowerCase();if(!_i.validID(e)){return Sn(t+"Database id '"+e+"' does not exist")}return _i.store[e]},dbShow:function(e,t){var n,r,i,s,o,u;n="[PS.dbShow] ";r=arguments.length;if(r<1){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(n+"Database id invalid")}e=e.toLowerCase();if(!_i.validID(e)){return Sn(n+"Database id '"+e+"' does not exist")}if(r===2){i=Qt(t);if(i==="string"){s={xlabel:"Time",ylabel:t}}else if(i==="object"){s=t}else{return Sn(n+"Invalid options parameter")}}else{s={xlabel:"Time",ylabel:"Data"}}o=_i.csv(n,e);if(o===PS.ERROR){return o}Q.style.display="block";try{u=new Dygraph(Q,o,s)}catch(a){Q.style.display="none";return En(n+"Dygraph display error ["+a.message+"]",a)}G=e;return e},dbHide:function(){var e;e="[PS.dbHide] ";if(arguments.length>1){return Sn(e+"Too many arguments")}Q.style.display="none";G=null;return PS.DONE},dbDump:function(e){var t,n,r;t="[PS.dbDump] ";n=arguments.length;if(n<1){return Sn(t+"Missing argument")}if(n>1){return Sn(t+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(t+"Database id invalid")}e=e.toLowerCase();if(!_i.validID(e)){return Sn(t+"Database id '"+e+"' does not exist")}r=_i.csv(t,e);if(r===PS.ERROR){return r}PS.debug(r);return e},dbSend:function(e,t){var n,r;n="[PS.dbSend] ";r=arguments.length;if(r<2){return Sn(n+"Missing argument(s)")}if(r>2){return Sn(n+"Too many arguments")}if(typeof e!=="string"||e.length<1){return Sn(n+"Database id invalid")}e=e.toLowerCase();if(!_i.validID(e)){return Sn(n+"Database id '"+e+"' does not exist")}if(typeof t!=="string"||t.length<1){return Sn(n+"Username invalid")}t=t.toLowerCase();if(!_i.validUser(t)){return Sn(n+"Username '"+e+"' not recognized")}return _i.send(n,e,t)}}})();(function(){"use strict";var e,t,n,r;e=0;t=["webkit","moz","ms","o"];for(n=0;n<t.length&&!window.requestAnimationFrame;n+=1){r=t[n];window.requestAnimationFrame=window[r+"RequestAnimationFrame"];window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,n){var r,i,s;r=(new Date).getTime();i=Math.max(0,16-(r-e));s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){window.clearTimeout(e)}}})()
